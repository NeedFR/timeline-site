/*

 // Underscore.js 1.1.7
 // (c) 2011 Jeremy Ashkenas, DocumentCloud Inc.
 // Underscore is freely distributable under the MIT license.
 // Portions of Underscore are inspired or borrowed from Prototype,
 // Oliver Steele's Functional, and John Resig's Micro-Templating.
 // For all details and documentation:
 // http://documentcloud.github.com/underscore
*/
(function(){var r=this,G=r._,A={},o=Array.prototype,H=Object.prototype,B=o.slice,x=o.unshift,w=H.toString,g=H.hasOwnProperty,I=o.forEach,C=o.map,e=o.reduce,q=o.reduceRight,s=o.filter,z=o.every,h=o.some,k=o.indexOf,p=o.lastIndexOf;H=Array.isArray;var E=Object.keys,a=Function.prototype.bind,c=function(d){return new u(d)};typeof module!=="undefined"&&module.exports?(module.exports=c,c._=c):r._=c;c.VERSION="1.1.7";var m=c.each=c.forEach=function(d,i,n){if(d!=null)if(I&&d.forEach===I)d.forEach(i,n);else if(d.length===
+d.length)for(var y=0,D=d.length;y<D;y++){if(y in d&&i.call(n,d[y],y,d)===A)break}else for(y in d)if(g.call(d,y)&&i.call(n,d[y],y,d)===A)break};c.map=function(d,i,n){var y=[];if(d==null)return y;if(C&&d.map===C)return d.map(i,n);m(d,function(D,J,L){y[y.length]=i.call(n,D,J,L)});return y};c.reduce=c.foldl=c.inject=function(d,i,n,y){var D=n!==void 0;d==null&&(d=[]);if(e&&d.reduce===e)return y&&(i=c.bind(i,y)),D?d.reduce(i,n):d.reduce(i);m(d,function(J,L,O){D?n=i.call(y,n,J,L,O):(n=J,D=true)});if(!D)throw new TypeError("Reduce of empty array with no initial value");
return n};c.reduceRight=c.foldr=function(d,i,n,y){d==null&&(d=[]);if(q&&d.reduceRight===q)return y&&(i=c.bind(i,y)),n!==void 0?d.reduceRight(i,n):d.reduceRight(i);d=(c.isArray(d)?d.slice():c.toArray(d)).reverse();return c.reduce(d,i,n,y)};c.find=c.detect=function(d,i,n){var y;f(d,function(D,J,L){if(i.call(n,D,J,L))return y=D,true});return y};c.filter=c.select=function(d,i,n){var y=[];if(d==null)return y;if(s&&d.filter===s)return d.filter(i,n);m(d,function(D,J,L){i.call(n,D,J,L)&&(y[y.length]=D)});
return y};c.reject=function(d,i,n){var y=[];if(d==null)return y;m(d,function(D,J,L){i.call(n,D,J,L)||(y[y.length]=D)});return y};c.every=c.all=function(d,i,n){var y=true;if(d==null)return y;if(z&&d.every===z)return d.every(i,n);m(d,function(D,J,L){if(!(y=y&&i.call(n,D,J,L)))return A});return y};var f=c.some=c.any=function(d,i,n){i=i||c.identity;var y=false;if(d==null)return y;if(h&&d.some===h)return d.some(i,n);m(d,function(D,J,L){if(y|=i.call(n,D,J,L))return A});return!!y};c.include=c.contains=function(d,
i){var n=false;if(d==null)return n;if(k&&d.indexOf===k)return d.indexOf(i)!=-1;f(d,function(y){if(n=y===i)return true});return n};c.invoke=function(d,i){var n=B.call(arguments,2);return c.map(d,function(y){return(i.call?i||y:y[i]).apply(y,n)})};c.pluck=function(d,i){return c.map(d,function(n){return n[i]})};c.max=function(d,i,n){if(!i&&c.isArray(d))return Math.max.apply(Math,d);var y={computed:-Infinity};m(d,function(D,J,L){J=i?i.call(n,D,J,L):D;J>=y.computed&&(y={value:D,computed:J})});return y.value};
c.min=function(d,i,n){if(!i&&c.isArray(d))return Math.min.apply(Math,d);var y={computed:Infinity};m(d,function(D,J,L){J=i?i.call(n,D,J,L):D;J<y.computed&&(y={value:D,computed:J})});return y.value};c.sortBy=function(d,i,n){return c.pluck(c.map(d,function(y,D,J){return{value:y,criteria:i.call(n,y,D,J)}}).sort(function(y,D){var J=y.criteria,L=D.criteria;return J<L?-1:J>L?1:0}),"value")};c.groupBy=function(d,i){var n={};m(d,function(y,D){var J=i(y,D);(n[J]||(n[J]=[])).push(y)});return n};c.sortedIndex=
function(d,i,n){n||(n=c.identity);for(var y=0,D=d.length;y<D;){var J=y+D>>1;n(d[J])<n(i)?y=J+1:D=J}return y};c.toArray=function(d){if(!d)return[];if(d.toArray)return d.toArray();if(c.isArray(d))return B.call(d);if(c.isArguments(d))return B.call(d);return c.values(d)};c.size=function(d){return c.toArray(d).length};c.first=c.head=function(d,i,n){return i!=null&&!n?B.call(d,0,i):d[0]};c.rest=c.tail=function(d,i,n){return B.call(d,i==null||n?1:i)};c.last=function(d){return d[d.length-1]};c.compact=function(d){return c.filter(d,
function(i){return!!i})};c.flatten=function(d){return c.reduce(d,function(i,n){if(c.isArray(n))return i.concat(c.flatten(n));i[i.length]=n;return i},[])};c.without=function(d){return c.difference(d,B.call(arguments,1))};c.uniq=c.unique=function(d,i){return c.reduce(d,function(n,y,D){if(0==D||(i===true?c.last(n)!=y:!c.include(n,y)))n[n.length]=y;return n},[])};c.union=function(){return c.uniq(c.flatten(arguments))};c.intersection=c.intersect=function(d){var i=B.call(arguments,1);return c.filter(c.uniq(d),
function(n){return c.every(i,function(y){return c.indexOf(y,n)>=0})})};c.difference=function(d,i){return c.filter(d,function(n){return!c.include(i,n)})};c.zip=function(){for(var d=B.call(arguments),i=c.max(c.pluck(d,"length")),n=Array(i),y=0;y<i;y++)n[y]=c.pluck(d,""+y);return n};c.indexOf=function(d,i,n){if(d==null)return-1;var y;if(n)return n=c.sortedIndex(d,i),d[n]===i?n:-1;if(k&&d.indexOf===k)return d.indexOf(i);n=0;for(y=d.length;n<y;n++)if(d[n]===i)return n;return-1};c.lastIndexOf=function(d,
i){if(d==null)return-1;if(p&&d.lastIndexOf===p)return d.lastIndexOf(i);for(var n=d.length;n--;)if(d[n]===i)return n;return-1};c.range=function(d,i,n){arguments.length<=1&&(i=d||0,d=0);n=arguments[2]||1;for(var y=Math.max(Math.ceil((i-d)/n),0),D=0,J=Array(y);D<y;){J[D++]=d;d+=n}return J};c.bind=function(d,i){if(d.bind===a&&a)return a.apply(d,B.call(arguments,1));var n=B.call(arguments,2);return function(){return d.apply(i,n.concat(B.call(arguments)))}};c.bindAll=function(d){var i=B.call(arguments,
1);i.length==0&&(i=c.functions(d));m(i,function(n){d[n]=c.bind(d[n],d)});return d};c.memoize=function(d,i){var n={};i||(i=c.identity);return function(){var y=i.apply(this,arguments);return g.call(n,y)?n[y]:n[y]=d.apply(this,arguments)}};c.delay=function(d,i){var n=B.call(arguments,2);return setTimeout(function(){return d.apply(d,n)},i)};c.defer=function(d){return c.delay.apply(c,[d,1].concat(B.call(arguments,1)))};var l=function(d,i,n){var y;return function(){var D=this,J=arguments,L=function(){y=
null;d.apply(D,J)};n&&clearTimeout(y);if(n||!y)y=setTimeout(L,i)}};c.throttle=function(d,i){return l(d,i,false)};c.debounce=function(d,i){return l(d,i,true)};c.once=function(d){var i=false,n;return function(){if(i)return n;i=true;return n=d.apply(this,arguments)}};c.wrap=function(d,i){return function(){var n=[d].concat(B.call(arguments));return i.apply(this,n)}};c.compose=function(){var d=B.call(arguments);return function(){for(var i=B.call(arguments),n=d.length-1;n>=0;n--)i=[d[n].apply(this,i)];
return i[0]}};c.after=function(d,i){return function(){if(--d<1)return i.apply(this,arguments)}};c.keys=E||function(d){if(d!==Object(d))throw new TypeError("Invalid object");var i=[],n;for(n in d)g.call(d,n)&&(i[i.length]=n);return i};c.values=function(d){return c.map(d,c.identity)};c.functions=c.methods=function(d){var i=[],n;for(n in d)c.isFunction(d[n])&&i.push(n);return i.sort()};c.extend=function(d){m(B.call(arguments,1),function(i){for(var n in i)i[n]!==void 0&&(d[n]=i[n])});return d};c.defaults=
function(d){m(B.call(arguments,1),function(i){for(var n in i)d[n]==null&&(d[n]=i[n])});return d};c.clone=function(d){return c.isArray(d)?d.slice():c.extend({},d)};c.tap=function(d,i){i(d);return d};c.isEqual=function(d,i){if(d===i)return true;var n=typeof d;if(n!=typeof i)return false;if(d==i)return true;if(!d&&i||d&&!i)return false;if(d._chain)d=d._wrapped;if(i._chain)i=i._wrapped;if(d.isEqual)return d.isEqual(i);if(i.isEqual)return i.isEqual(d);if(c.isDate(d)&&c.isDate(i))return d.getTime()===i.getTime();
if(c.isNaN(d)&&c.isNaN(i))return false;if(c.isRegExp(d)&&c.isRegExp(i))return d.source===i.source&&d.global===i.global&&d.ignoreCase===i.ignoreCase&&d.multiline===i.multiline;if(n!=="object")return false;if(d.length&&d.length!==i.length)return false;n=c.keys(d);var y=c.keys(i);if(n.length!=y.length)return false;for(var D in d)if(!(D in i)||!c.isEqual(d[D],i[D]))return false;return true};c.isEmpty=function(d){if(c.isArray(d)||c.isString(d))return d.length===0;for(var i in d)if(g.call(d,i))return false;
return true};c.isElement=function(d){return!!(d&&d.nodeType==1)};c.isArray=H||function(d){return w.call(d)==="[object Array]"};c.isObject=function(d){return d===Object(d)};c.isArguments=function(d){return!(!d||!g.call(d,"callee"))};c.isFunction=function(d){return!(!d||!d.constructor||!d.call||!d.apply)};c.isString=function(d){return!!(d===""||d&&d.charCodeAt&&d.substr)};c.isNumber=function(d){return!!(d===0||d&&d.toExponential&&d.toFixed)};c.isNaN=function(d){return d!==d};c.isBoolean=function(d){return d===
true||d===false};c.isDate=function(d){return!(!d||!d.getTimezoneOffset||!d.setUTCFullYear)};c.isRegExp=function(d){return!(!d||!d.test||!d.exec||!(d.ignoreCase||d.ignoreCase===false))};c.isNull=function(d){return d===null};c.isUndefined=function(d){return d===void 0};c.noConflict=function(){r._=G;return this};c.identity=function(d){return d};c.times=function(d,i,n){for(var y=0;y<d;y++)i.call(n,y)};c.mixin=function(d){m(c.functions(d),function(i){F(i,c[i]=d[i])})};var j=0;c.uniqueId=function(d){var i=
j++;return d?d+i:i};c.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g};c.template=function(d,i){var n=c.templateSettings;n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+d.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(n.interpolate,function(y,D){return"',"+D.replace(/\\'/g,"'")+",'"}).replace(n.evaluate||null,function(y,D){return"');"+D.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,
"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');";n=new Function("obj",n);return i?n(i):n};var u=function(d){this._wrapped=d};c.prototype=u.prototype;var v=function(d,i){return i?c(d).chain():d},F=function(d,i){u.prototype[d]=function(){var n=B.call(arguments);x.call(n,this._wrapped);return v(i.apply(c,n),this._chain)}};c.mixin(c);m(["pop","push","reverse","shift","sort","splice","unshift"],function(d){var i=o[d];u.prototype[d]=function(){i.apply(this._wrapped,arguments);return v(this._wrapped,
this._chain)}});m(["concat","join","slice"],function(d){var i=o[d];u.prototype[d]=function(){return v(i.apply(this._wrapped,arguments),this._chain)}});u.prototype.chain=function(){this._chain=true;return this};u.prototype.value=function(){return this._wrapped}})();/*

 // Backbone.js 0.5.3
 // (c) 2010 Jeremy Ashkenas, DocumentCloud Inc.
 // Backbone may be freely distributed under the MIT license.
 // For all details and documentation:
 // http://documentcloud.github.com/backbone
*/
(function(){var r=this,G=r.Backbone,A;A=typeof exports!=="undefined"?exports:r.Backbone={};A.VERSION="0.5.3";var o=r._;if(!o&&typeof require!=="undefined")o=require("underscore")._;var H=r.jQuery||r.Zepto;A.noConflict=function(){r.Backbone=G;return this};A.emulateHTTP=false;A.emulateJSON=false;A.Events={bind:function(a,c,m){var f=this._callbacks||(this._callbacks={});(f[a]||(f[a]=[])).push([c,m]);return this},unbind:function(a,c){var m;if(a){if(m=this._callbacks)if(c){m=m[a];if(!m)return this;for(var f=
0,l=m.length;f<l;f++)if(m[f]&&c===m[f][0]){m[f]=null;break}}else m[a]=[]}else this._callbacks={};return this},trigger:function(a){var c,m,f,l,j=2;if(!(m=this._callbacks))return this;for(;j--;)if(c=j?a:"all",c=m[c])for(var u=0,v=c.length;u<v;u++)(f=c[u])?(l=j?Array.prototype.slice.call(arguments,1):arguments,f[0].apply(f[1]||this,l)):(c.splice(u,1),u--,v--);return this}};A.Model=function(a,c){var m;a||(a={});if(m=this.defaults){o.isFunction(m)&&(m=m.call(this));a=o.extend({},m,a)}this.attributes={};
this._escapedAttributes={};this.cid=o.uniqueId("c");this.set(a,{silent:true});this._changed=false;this._previousAttributes=o.clone(this.attributes);if(c&&c.collection)this.collection=c.collection;this.initialize(a,c)};o.extend(A.Model.prototype,A.Events,{_previousAttributes:null,_changed:false,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var c;if(c=this._escapedAttributes[a])return c;c=this.attributes[a];
return this._escapedAttributes[a]=(c==null?"":""+c).replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},has:function(a){return this.attributes[a]!=null},set:function(a,c){c||(c={});if(!a)return this;if(a.attributes)a=a.attributes;var m=this.attributes,f=this._escapedAttributes;if(!c.silent&&this.validate&&!this._performValidation(a,c))return false;if(this.idAttribute in a)this.id=a[this.idAttribute];
var l=this._changing;this._changing=true;for(var j in a){var u=a[j];if(!o.isEqual(m[j],u)){m[j]=u;delete f[j];this._changed=true;c.silent||this.trigger("change:"+j,this,u,c)}}!l&&!c.silent&&this._changed&&this.change(c);this._changing=false;return this},unset:function(a,c){if(!(a in this.attributes))return this;c||(c={});var m={};m[a]=void 0;if(!c.silent&&this.validate&&!this._performValidation(m,c))return false;delete this.attributes[a];delete this._escapedAttributes[a];a==this.idAttribute&&delete this.id;
this._changed=true;c.silent||(this.trigger("change:"+a,this,void 0,c),this.change(c));return this},clear:function(a){a||(a={});var c,m=this.attributes,f={};for(c in m)f[c]=void 0;if(!a.silent&&this.validate&&!this._performValidation(f,a))return false;this.attributes={};this._escapedAttributes={};this._changed=true;if(!a.silent){for(c in m)this.trigger("change:"+c,this,void 0,a);this.change(a)}return this},fetch:function(a){a||(a={});var c=this,m=a.success;a.success=function(f,l,j){if(!c.set(c.parse(f,
j),a))return false;m&&m(c,f)};a.error=E(a.error,c,a);return(this.sync||A.sync).call(this,"read",this,a)},save:function(a,c){c||(c={});if(a&&!this.set(a,c))return false;var m=this,f=c.success;c.success=function(j,u,v){if(!m.set(m.parse(j,v),c))return false;f&&f(m,j,v)};c.error=E(c.error,m,c);var l=this.isNew()?"create":"update";return(this.sync||A.sync).call(this,l,this,c)},destroy:function(a){a||(a={});if(this.isNew())return this.trigger("destroy",this,this.collection,a);var c=this,m=a.success;a.success=
function(f){c.trigger("destroy",c,c.collection,a);m&&m(c,f)};a.error=E(a.error,c,a);return(this.sync||A.sync).call(this,"delete",this,a)},url:function(){var a=k(this.collection)||this.urlRoot||p();if(this.isNew())return a;return a+(a.charAt(a.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this)},isNew:function(){return this.id==null},change:function(a){this.trigger("change",this,a);this._previousAttributes=o.clone(this.attributes);
this._changed=false},hasChanged:function(a){if(a)return this._previousAttributes[a]!=this.attributes[a];return this._changed},changedAttributes:function(a){a||(a=this.attributes);var c=this._previousAttributes,m=false,f;for(f in a)o.isEqual(c[f],a[f])||(m=m||{},m[f]=a[f]);return m},previous:function(a){if(!a||!this._previousAttributes)return null;return this._previousAttributes[a]},previousAttributes:function(){return o.clone(this._previousAttributes)},_performValidation:function(a,c){var m=this.validate(a);
if(m)return c.error?c.error(this,m,c):this.trigger("error",this,m,c),false;return true}});A.Collection=function(a,c){c||(c={});if(c.comparator)this.comparator=c.comparator;o.bindAll(this,"_onModelEvent","_removeReference");this._reset();a&&this.reset(a,{silent:true});this.initialize.apply(this,arguments)};o.extend(A.Collection.prototype,A.Events,{model:A.Model,initialize:function(){},toJSON:function(){return this.map(function(a){return a.toJSON()})},add:function(a,c){if(o.isArray(a))for(var m=0,f=
a.length;m<f;m++)this._add(a[m],c);else this._add(a,c);return this},remove:function(a,c){if(o.isArray(a))for(var m=0,f=a.length;m<f;m++)this._remove(a[m],c);else this._remove(a,c);return this},get:function(a){if(a==null)return null;return this._byId[a.id!=null?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");this.models=this.sortBy(this.comparator);
a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return o.map(this.models,function(c){return c.get(a)})},reset:function(a,c){a||(a=[]);c||(c={});this.each(this._removeReference);this._reset();this.add(a,{silent:true});c.silent||this.trigger("reset",this,c);return this},fetch:function(a){a||(a={});var c=this,m=a.success;a.success=function(f,l,j){c[a.add?"add":"reset"](c.parse(f,j),a);m&&m(c,f)};a.error=E(a.error,c,a);return(this.sync||A.sync).call(this,"read",this,a)},create:function(a,
c){var m=this;c||(c={});a=this._prepareModel(a,c);if(!a)return false;var f=c.success;c.success=function(l,j,u){m.add(l,c);f&&f(l,j,u)};a.save(null,c);return a},parse:function(a){return a},chain:function(){return o(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(a,c){if(a instanceof A.Model){if(!a.collection)a.collection=this}else{var m=a;a=new this.model(m,{collection:this});a.validate&&!a._performValidation(m,c)&&(a=false)}return a},
_add:function(a,c){c||(c={});a=this._prepareModel(a,c);if(!a)return false;var m=this.getByCid(a);if(m)throw Error(["Can't add the same model to a set twice",m.id]);this._byId[a.id]=a;this._byCid[a.cid]=a;this.models.splice(c.at!=null?c.at:this.comparator?this.sortedIndex(a,this.comparator):this.length,0,a);a.bind("all",this._onModelEvent);this.length++;c.silent||a.trigger("add",a,this,c);return a},_remove:function(a,c){c||(c={});a=this.getByCid(a)||this.get(a);if(!a)return null;delete this._byId[a.id];
delete this._byCid[a.cid];this.models.splice(this.indexOf(a),1);this.length--;c.silent||a.trigger("remove",a,this,c);this._removeReference(a);return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.unbind("all",this._onModelEvent)},_onModelEvent:function(a,c,m,f){(a=="add"||a=="remove")&&m!=this||(a=="destroy"&&this._remove(c,f),c&&a==="change:"+c.idAttribute&&(delete this._byId[c.previous(c.idAttribute)],this._byId[c.id]=c),this.trigger.apply(this,arguments))}});o.each(["forEach",
"each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty","groupBy"],function(a){A.Collection.prototype[a]=function(){return o[a].apply(o,[this.models].concat(o.toArray(arguments)))}});A.Router=function(a){a||(a={});if(a.routes)this.routes=a.routes;this._bindRoutes();this.initialize.apply(this,arguments)};
var B=/:([\w\d]+)/g,x=/\*([\w\d]+)/g,w=/[-[\]{}()+?.,\\^$|#\s]/g;o.extend(A.Router.prototype,A.Events,{initialize:function(){},route:function(a,c,m){A.history||(A.history=new A.History);o.isRegExp(a)||(a=this._routeToRegExp(a));A.history.route(a,o.bind(function(f){f=this._extractParameters(a,f);m.apply(this,f);this.trigger.apply(this,["route:"+c].concat(f))},this))},navigate:function(a,c){A.history.navigate(a,c)},_bindRoutes:function(){if(this.routes){var a=[],c;for(c in this.routes)a.unshift([c,
this.routes[c]]);c=0;for(var m=a.length;c<m;c++)this.route(a[c][0],a[c][1],this[a[c][1]])}},_routeToRegExp:function(a){a=a.replace(w,"\\$&").replace(B,"([^/]*)").replace(x,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,c){return a.exec(c).slice(1)}});A.History=function(){this.handlers=[];o.bindAll(this,"checkUrl")};var g=/^#*/,I=/msie [\w.]+/,C=false;o.extend(A.History.prototype,{interval:50,getFragment:function(a,c){if(a==null)if(this._hasPushState||c){a=window.location.pathname;
var m=window.location.search;m&&(a+=m);a.indexOf(this.options.root)==0&&(a=a.substr(this.options.root.length))}else a=window.location.hash;return decodeURIComponent(a.replace(g,""))},start:function(a){if(C)throw Error("Backbone.history has already been started");this.options=o.extend({},{root:"/"},this.options,a);this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);a=this.getFragment();var c=document.documentMode;if(c=
I.exec(navigator.userAgent.toLowerCase())&&(!c||c<=7)){this.iframe=H('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(a)}this._hasPushState?H(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!c?H(window).bind("hashchange",this.checkUrl):setInterval(this.checkUrl,this.interval);this.fragment=a;C=true;a=window.location;c=a.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!c)return this.fragment=this.getFragment(null,
true),window.location.replace(this.options.root+"#"+this.fragment),true;else if(this._wantsPushState&&this._hasPushState&&c&&a.hash){this.fragment=a.hash.replace(g,"");window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment)}if(!this.options.silent)return this.loadUrl()},route:function(a,c){this.handlers.unshift({route:a,callback:c})},checkUrl:function(){var a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.iframe.location.hash));
if(a==this.fragment||a==decodeURIComponent(this.fragment))return false;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(a){var c=this.fragment=this.getFragment(a);return o.any(this.handlers,function(m){if(m.route.test(c))return m.callback(c),true})},navigate:function(a,c){var m=(a||"").replace(g,"");if(!(this.fragment==m||this.fragment==decodeURIComponent(m))){if(this._hasPushState){var f=window.location;m.indexOf(this.options.root)!=0&&(m=this.options.root+
m);this.fragment=m;window.history.pushState({},document.title,f.protocol+"//"+f.host+m)}else if(window.location.hash=this.fragment=m,this.iframe&&m!=this.getFragment(this.iframe.location.hash)){this.iframe.document.open().close();this.iframe.location.hash=m}c&&this.loadUrl(a)}}});A.View=function(a){this.cid=o.uniqueId("view");this._configure(a||{});this._ensureElement();this.delegateEvents();this.initialize.apply(this,arguments)};var e=/^(\S+)\s*(.*)$/,q=["model","collection","el","id","attributes",
"className","tagName"];o.extend(A.View.prototype,A.Events,{tagName:"div",$:function(a){return H(a,this.el)},initialize:function(){},render:function(){return this},remove:function(){H(this.el).remove();return this},make:function(a,c,m){a=document.createElement(a);c&&H(a).attr(c);m&&H(a).html(m);return a},delegateEvents:function(a){if(a||(a=this.events))for(var c in o.isFunction(a)&&(a=a.call(this)),H(this.el).unbind(".delegateEvents"+this.cid),a){var m=this[a[c]];if(!m)throw Error('Event "'+a[c]+'" does not exist');
var f=c.match(e),l=f[1];f=f[2];m=o.bind(m,this);l+=".delegateEvents"+this.cid;f===""?H(this.el).bind(l,m):H(this.el).delegate(f,l,m)}},_configure:function(a){this.options&&(a=o.extend({},this.options,a));for(var c=0,m=q.length;c<m;c++){var f=q[c];a[f]&&(this[f]=a[f])}this.options=a},_ensureElement:function(){if(this.el){if(o.isString(this.el))this.el=H(this.el).get(0)}else{var a=this.attributes||{};if(this.id)a.id=this.id;if(this.className)a["class"]=this.className;this.el=this.make(this.tagName,
a)}}});A.Model.extend=A.Collection.extend=A.Router.extend=A.View.extend=function(a,c){var m=h(this,a,c);m.extend=this.extend;return m};var s={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};A.sync=function(a,c,m){var f=s[a];m=o.extend({type:f,dataType:"json"},m);if(!m.url)m.url=k(c)||p();if(!m.data&&c&&(a=="create"||a=="update")){m.contentType="application/json";m.data=JSON.stringify(c.toJSON())}if(A.emulateJSON){m.contentType="application/x-www-form-urlencoded";m.data=m.data?{model:m.data}:
{}}if(A.emulateHTTP&&(f==="PUT"||f==="DELETE")){if(A.emulateJSON)m.data._method=f;m.type="POST";m.beforeSend=function(l){l.setRequestHeader("X-HTTP-Method-Override",f)}}if(m.type!=="GET"&&!A.emulateJSON)m.processData=false;return H.ajax(m)};var z=function(){},h=function(a,c,m){var f;f=c&&c.hasOwnProperty("constructor")?c.constructor:function(){return a.apply(this,arguments)};o.extend(f,a);z.prototype=a.prototype;f.prototype=new z;c&&o.extend(f.prototype,c);m&&o.extend(f,m);f.prototype.constructor=
f;f.__super__=a.prototype;return f},k=function(a){if(!a||!a.url)return null;return o.isFunction(a.url)?a.url():a.url},p=function(){throw Error('A "url" property or function must be specified');},E=function(a,c,m){return function(f){a?a(c,f,m):c.trigger("error",c,f,m)}}}).call(this);/*

 jQuery Templates Plugin 1.0.0pre
 http://github.com/jquery/jquery-tmpl
 Requires jQuery 1.4.2

 Copyright Software Freedom Conservancy, Inc.
 Dual licensed under the MIT or GPL Version 2 licenses.
 http://jquery.org/license
*/
(function(r){function G(l,j,u,v){v={data:v||v===0||v===false?v:j?j.data:{},_wrap:j?j._wrap:null,tmpl:null,parent:j||null,nodes:[],calls:g,nest:I,wrap:C,html:e,update:q};l&&r.extend(v,l,{nodes:[],parent:j});if(u){v.tmpl=u;v._ctnt=v._ctnt||v.tmpl(r,v);v.key=++c;(f.length?p:k)[c]=v}return v}function A(l,j,u){var v;u=u?r.map(u,function(F){return typeof F==="string"?l.key?F.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+z+'="'+l.key+'" $2'):F:A(F,l,F._ctnt)}):l;if(j)return u;u=u.join("");u.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(F,d,i,n){v=r(i).get();w(v);if(d)v=o(d).concat(v);if(n)v=v.concat(o(n))});return v?v:o(u)}function o(l){var j=document.createElement("div");j.innerHTML=l;return r.makeArray(j.childNodes)}function H(l){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+r.trim(l).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(j,u,v,F,d,i,n){j=r.tmpl.tag[v];if(!j)throw"Unknown template tag: "+v;v=j._default||[];if(i&&!/\w$/.test(d)){d+=i;i=""}if(d){d=x(d);n=n?","+x(n)+")":i?")":"";n=i?d.indexOf(".")>-1?d+x(i):"("+d+").call($item"+n:d;i=i?n:"(typeof("+d+")==='function'?("+d+").call($item):("+d+"))"}else i=n=v.$1||"null";F=x(F);return"');"+j[u?"close":"open"].split("$notnull_1").join(d?"typeof("+d+")!=='undefined' && ("+d+")!=null":"true").split("$1a").join(i).split("$1").join(n).split("$2").join(F||v.$2||"")+"__.push('"})+
"');}return __;")}function B(l,j){l._wrap=A(l,true,r.isArray(j)?j:[h.test(j)?j:r(j).html()]).join("")}function x(l){return l?l.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function w(l){function j(D){function J(P){P+=u;K=d[P]=d[P]||G(K,k[K.parent.key+u]||K.parent)}var L,O=D,K,Q;if(Q=D.getAttribute(z)){for(;O.parentNode&&(O=O.parentNode).nodeType===1&&!(L=O.getAttribute(z)););if(L!==Q){O=O.parentNode?O.nodeType===11?0:O.getAttribute(z)||0:0;if(!(K=k[Q])){K=p[Q];K=G(K,k[O]||p[O]);K.key=++c;k[c]=K}m&&
J(Q)}D.removeAttribute(z)}else if(m&&(K=r.data(D,"tmplItem"))){J(K.key);k[K.key]=K;O=(O=r.data(D.parentNode,"tmplItem"))?O.key:0}if(K){for(L=K;L&&L.key!=O;){L.nodes.push(D);L=L.parent}delete K._ctnt;delete K._wrap;r.data(D,"tmplItem",K)}}var u="_"+m,v,F,d={},i,n,y;i=0;for(n=l.length;i<n;i++)if((v=l[i]).nodeType===1){F=v.getElementsByTagName("*");for(y=F.length-1;y>=0;y--)j(F[y]);j(v)}}function g(l,j,u,v){if(!l)return f.pop();f.push({_:l,tmpl:j,item:this,data:u,options:v})}function I(l,j,u){return r.tmpl(r.template(l),
j,u,this)}function C(l,j){var u=l.options||{};u.wrapped=j;return r.tmpl(r.template(l.tmpl),l.data,u,l.item)}function e(l,j){var u=this._wrap;return r.map(r(r.isArray(u)?u.join(""):u).filter(l||"*"),function(v){if(j)v=v.innerText||v.textContent;else{var F;if(!(F=v.outerHTML)){F=document.createElement("div");F.appendChild(v.cloneNode(true));F=F.innerHTML}v=F}return v})}function q(){var l=this.nodes;r.tmpl(null,null,null,this).insertBefore(l[0]);r(l).remove()}var s=r.fn.domManip,z="_tmplitem",h=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,
k={},p={},E,a={key:0,data:{}},c=0,m=0,f=[];r.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(l,j){r.fn[l]=function(u){var v=[];u=r(u);var F,d,i;F=this.length===1&&this[0].parentNode;E=k||{};if(F&&F.nodeType===11&&F.childNodes.length===1&&u.length===1){u[j](this[0]);v=this}else{d=0;for(i=u.length;d<i;d++){m=d;F=(d>0?this.clone(true):this).get();r(u[d])[j](F);v=v.concat(F)}m=0;v=this.pushStack(v,l,u.selector)}u=E;E=null;r.tmpl.complete(u);
return v}});r.fn.extend({tmpl:function(l,j,u){return r.tmpl(this[0],l,j,u)},tmplItem:function(){return r.tmplItem(this[0])},template:function(l){return r.template(l,this[0])},domManip:function(l,j,u){if(l[0]&&r.isArray(l[0])){for(var v=r.makeArray(arguments),F=l[0],d=F.length,i=0,n;i<d&&!(n=r.data(F[i++],"tmplItem")););if(n&&m)v[2]=function(y){r.tmpl.afterManip(this,y,u)};s.apply(this,v)}else s.apply(this,arguments);m=0;E||r.tmpl.complete(k);return this}});r.extend({tmpl:function(l,j,u,v){var F=!v;
if(F){v=a;l=r.template[l]||r.template(null,l);p={}}else if(!l){l=v.tmpl;k[v.key]=v;v.nodes=[];v.wrapped&&B(v,v.wrapped);return r(A(v,null,v.tmpl(r,v)))}if(!l)return[];if(typeof j==="function")j=j.call(v||{});u&&u.wrapped&&B(u,u.wrapped);j=r.isArray(j)?r.map(j,function(d){return d?G(u,v,l,d):null}):[G(u,v,l,j)];return F?r(A(v,null,j)):j},tmplItem:function(l){var j;if(l instanceof r)l=l[0];for(;l&&l.nodeType===1&&!(j=r.data(l,"tmplItem"))&&(l=l.parentNode););return j||a},template:function(l,j){if(j){if(typeof j===
"string")j=H(j);else if(j instanceof r)j=j[0]||{};if(j.nodeType)j=r.data(j,"tmpl")||r.data(j,"tmpl",H(j.innerHTML));return typeof l==="string"?r.template[l]=j:j}return l?typeof l!=="string"?r.template(null,l):r.template[l]||r.template(null,h.test(l)?l:r(l)):null},encode:function(l){return(""+l).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});r.extend(r.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},
wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){k=
{}},afterManip:function(l,j,u){var v=j.nodeType===11?r.makeArray(j.childNodes):j.nodeType===1?[j]:[];u.call(l,j);w(v);m++}})})(jQuery);/*
 
 JavaScript Debug - v0.4 - 6/22/2010
 http://benalman.com/projects/javascript-debug-console-log/

 Copyright (c) 2010 "Cowboy" Ben Alman
 Dual licensed under the MIT and GPL licenses.
 http://benalman.com/about/license/

 With lots of help from Paul Irish!
 http://paulirish.com/
*/
window.debug=function(){function r(q){if(B&&(x||!o||!o.log))B.apply(G,q)}for(var G=this,A=Array.prototype.slice,o=G.console,H={},B,x,w=9,g=["error","warn","info","debug","log"],I="assert clear count dir dirxml exception group groupCollapsed groupEnd profile profileEnd table time timeEnd trace".split(" "),C=I.length,e=[];--C>=0;)(function(q){H[q]=function(){w!==0&&o&&o[q]&&o[q].apply(o,arguments)}})(I[C]);for(C=g.length;--C>=0;)(function(q,s){H[s]=function(){var z=A.call(arguments),h=[s].concat(z);
e.push(h);r(h);if(o&&(w>0?w>q:g.length+w<=q))o.firebug?o[s].apply(G,z):o[s]?o[s](z):o.log(z)}})(C,g[C]);H.setLevel=function(q){w=typeof q==="number"?q:9};H.setCallback=function(){var q=A.call(arguments),s=e.length,z=s;B=q.shift()||null;x=typeof q[0]==="boolean"?q.shift():false;for(z-=typeof q[0]==="number"?q.shift():s;z<s;)r(e[z++])};return H}();(function(r){var G=r("<b/>");r.subscribe=function(A,o){function H(){return o.apply(this,Array.prototype.slice.call(arguments,1))}H.guid=o.guid=o.guid||(r.guid?r.guid++:r.event.guid++);G.bind(A,H)};r.unsubscribe=function(){G.unbind.apply(G,arguments)};r.publish=function(){G.trigger.apply(G,arguments)}})(jQuery);(function(r){function G(H){var B=H||window.event,x=[].slice.call(arguments,1),w=0,g=0,I=0;return H=r.event.fix(B),H.type="mousewheel",B.detail&&(w=-B.detail/3),B.wheelDeltaY!==undefined&&(I=B.wheelDeltaY/120),B.wheelDeltaX!==undefined&&(g=-1*B.wheelDeltaX/120),x.unshift(H,w,g,I),(r.event.dispatch||r.event.handle).apply(this,x)}var A=["DOMMouseScroll","mousewheel"];if(r.event.fixHooks)for(var o=A.length;o;)r.event.fixHooks[A[--o]]=r.event.mouseHooks;r.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var H=
A.length;H;)this.addEventListener(A[--H],G,false);else this.onmousewheel=G},teardown:function(){if(this.removeEventListener)for(var H=A.length;H;)this.removeEventListener(A[--H],G,false);else this.onmousewheel=null}};r.fn.extend({mousewheel:function(H){return H?this.bind("mousewheel",H):this.trigger("mousewheel")},unmousewheel:function(H){return this.unbind("mousewheel",H)}})})(jQuery);$(function(){$.extend($.support,{touch:"ontouchend"in document});$.fn.addTouch=function(){$.support.touch&&this.each(function(r,G){G.addEventListener("touchstart",iPadTouchHandler,false);G.addEventListener("touchmove",iPadTouchHandler,false);G.addEventListener("touchend",iPadTouchHandler,false);G.addEventListener("touchcancel",iPadTouchHandler,false)})}});var lastTap=null,tapValid=false,tapTimeout=null;function cancelTap(){tapValid=false}
var rightClickPending=false,rightClickEvent=null,holdTimeout=null,cancelMouseUp=false;function cancelHold(){if(rightClickPending){window.clearTimeout(holdTimeout);rightClickPending=false;rightClickEvent=null}}function startHold(r){if(!rightClickPending){rightClickPending=true;rightClickEvent=r.changedTouches[0];holdTimeout=window.setTimeout("doRightClick();",800)}}
function doRightClick(){rightClickPending=false;var r=rightClickEvent,G=document.createEvent("MouseEvent");G.initMouseEvent("mouseup",true,true,window,1,r.screenX,r.screenY,r.clientX,r.clientY,false,false,false,false,0,null);r.target.dispatchEvent(G);G=document.createEvent("MouseEvent");G.initMouseEvent("mousedown",true,true,window,1,r.screenX,r.screenY,r.clientX,r.clientY,false,false,false,false,2,null);r.target.dispatchEvent(G);G=document.createEvent("MouseEvent");G.initMouseEvent("contextmenu",
true,true,window,1,r.screenX+50,r.screenY+5,r.clientX+50,r.clientY+5,false,false,false,false,2,null);r.target.dispatchEvent(G);cancelMouseUp=true;rightClickEvent=null}
function iPadTouchStart(r){var G=r.changedTouches[0],A="mouseover",o=document.createEvent("MouseEvent");o.initMouseEvent(A,true,true,window,1,G.screenX,G.screenY,G.clientX,G.clientY,false,false,false,false,0,null);G.target.dispatchEvent(o);A="mousedown";o=document.createEvent("MouseEvent");o.initMouseEvent(A,true,true,window,1,G.screenX,G.screenY,G.clientX,G.clientY,false,false,false,false,0,null);G.target.dispatchEvent(o);if(tapValid){window.clearTimeout(tapTimeout);if(G.target==lastTap){lastTap=
null;tapValid=false;A="click";o=document.createEvent("MouseEvent");o.initMouseEvent(A,true,true,window,1,G.screenX,G.screenY,G.clientX,G.clientY,false,false,false,false,0,null);G.target.dispatchEvent(o);A="dblclick";o=document.createEvent("MouseEvent");o.initMouseEvent(A,true,true,window,1,G.screenX,G.screenY,G.clientX,G.clientY,false,false,false,false,0,null);G.target.dispatchEvent(o)}else{lastTap=G.target;tapValid=true;tapTimeout=window.setTimeout("cancelTap();",600);startHold(r)}}else{lastTap=
G.target;tapValid=true;tapTimeout=window.setTimeout("cancelTap();",600);startHold(r)}}
function iPadTouchHandler(r){var G="";if(!(r.touches.length>1)){switch(r.type){case "touchstart":if($(r.changedTouches[0].target).is("select"))return;iPadTouchStart(r);r.preventDefault();return false;case "touchmove":cancelHold();G="mousemove";r.preventDefault();break;case "touchend":if(cancelMouseUp){cancelMouseUp=false;r.preventDefault();return false}cancelHold();G="mouseup";break;default:return}r=r.changedTouches[0];var A=document.createEvent("MouseEvent");A.initMouseEvent(G,true,true,window,1,
r.screenX,r.screenY,r.clientX,r.clientY,false,false,false,false,0,null);r.target.dispatchEvent(A);if(G=="mouseup"&&tapValid&&r.target==lastTap){A=document.createEvent("MouseEvent");A.initMouseEvent("click",true,true,window,1,r.screenX,r.screenY,r.clientX,r.clientY,false,false,false,false,0,null);r.target.dispatchEvent(A)}}};(function(){function r(f){return(f+"").replace(p,"")}function G(f,l,j){for(var u=f.length;u<l;u++)f=j?"0"+f:f+"0";return f}function A(f){return m.call(f)==="[object Array]"}function o(f,l){if(f.indexOf)return f.indexOf(l);for(var j=0,u=f.length;j<u;j++)if(f[j]===l)return j;return-1}function H(f,l,j){var u=l["-"];l=l["+"];var v;switch(j){case "n -":u=" "+u;l=" "+l;case "n-":if(f.substr(f.length-u.length)===u)v=["-",f.substr(0,f.length-u.length)];else if(f.substr(f.length-l.length)===l)v=["+",f.substr(0,
f.length-l.length)];break;case "- n":u+=" ";l+=" ";case "-n":if(f.indexOf(u)===0)v=["-",f.substr(u.length)];else if(f.indexOf(l)===0)v=["+",f.substr(l.length)];break;case "(n)":if(f.indexOf("(")===0&&f.substr(f.length-1)===")")v=["-",f.substr(1,f.length-2)]}return v||["",f]}function B(f,l){if(!l)return 0;for(var j,u=f.getTime(),v=0,F=l.length;v<F;v++){j=l[v].start;if(j===null||u>=j)return v}return 0}function x(f){return f.split("\u00a0").join(" ").toUpperCase()}function w(f){for(var l=[],j=0,u=f.length;j<
u;j++)l[j]=x(f[j]);return l}function g(f,l,j,u){f=f.getFullYear();if(!u&&l.eras)f-=l.eras[j].offset;return f}function I(f,l){for(var j=0,u=false,v=0,F=f.length;v<F;v++){var d=f.charAt(v);switch(d){case "'":if(u)l.push("'");else j++;u=false;break;case "\\":u&&l.push("\\");u=!u;break;default:l.push(d);u=false}}return j}function C(f,l){l=l||"F";var j;j=f.patterns;var u=l.length;if(u===1){j=j[l];if(!j)throw"Invalid date format string '"+l+"'.";l=j}else if(u===2&&l.charAt(0)==="%")l=l.charAt(1);return l}
function e(){return/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|gg|g/g}function q(f,l,j){f=r(f);j=j.calendar;a:{var u=j._parseRegExp;if(u){var v=u[l];if(v){l=v;break a}}else j._parseRegExp=u={};v=C(j,l).replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1");for(var F=["^"],d=[],i=0,n=0,y=e(),D;(D=y.exec(v))!==null;){var J=v.slice(i,D.index);i=y.lastIndex;n+=I(J,F);if(n%2)F.push(D[0]);else{J=D[0];var L=J.length;switch(J){case "dddd":case "ddd":case "MMMM":case "MMM":case "gg":case "g":J=
"(\\D+)";break;case "tt":case "t":J="(\\D*)";break;case "yyyy":case "fff":case "ff":case "f":J="(\\d{"+L+"})";break;case "dd":case "d":case "MM":case "M":case "yy":case "y":case "HH":case "H":case "hh":case "h":case "mm":case "m":case "ss":case "s":J="(\\d\\d?)";break;case "zzz":J="([+-]?\\d\\d?:\\d{2})";break;case "zz":case "z":J="([+-]?\\d\\d?)";break;case "/":J="(\\"+j["/"]+")";break;default:throw"Invalid date format pattern '"+J+"'.";}J&&F.push(J);d.push(D[0])}}I(v.slice(i),F);F.push("$");v={regExp:F.join("").replace(/\s+/g,
"\\s+"),groups:d};l=u[l]=v}n=RegExp(l.regExp).exec(f);if(n===null)return null;y=l.groups;var O=f=null,K=null,Q=l=null;d=F=v=u=0;D=null;i=false;J=0;for(L=y.length;J<L;J++){var P=n[J+1];if(P){var R=y[J],M=R.length,N=parseInt(P,10);switch(R){case "dd":case "d":l=N;if(l<1||l>31)return null;break;case "MMM":case "MMMM":K=j;M=M===3;R=K.months;var S=K.monthsGenitive||K.months,T=K._upperMonths;N=K._upperMonthsGen;if(!T){K._upperMonths=T=[w(R.names),w(R.namesAbbr)];K._upperMonthsGen=N=[w(S.names),w(S.namesAbbr)]}P=
x(P);K=o(M?T[1]:T[0],P);if(K<0)K=o(M?N[1]:N[0],P);if(K<0||K>11)return null;break;case "M":case "MM":K=N-1;if(K<0||K>11)return null;break;case "y":case "yy":case "yyyy":if(M<4){O=j;P=N;N=new Date;R=B(N);if(P<100){M=O.twoDigitYearMax;M=typeof M==="string"?(new Date).getFullYear()%100+parseInt(M,10):M;O=g(N,O,R);P+=O-O%100;if(P>M)P-=100}O=P}else O=N;if(O<0||O>9999)return null;break;case "h":case "hh":u=N;if(u===12)u=0;if(u<0||u>11)return null;break;case "H":case "HH":u=N;if(u<0||u>23)return null;break;
case "m":case "mm":v=N;if(v<0||v>59)return null;break;case "s":case "ss":F=N;if(F<0||F>59)return null;break;case "tt":case "t":i=j.PM&&(P===j.PM[0]||P===j.PM[1]||P===j.PM[2]);if(!i&&(!j.AM||P!==j.AM[0]&&P!==j.AM[1]&&P!==j.AM[2]))return null;break;case "f":case "ff":case "fff":d=N*Math.pow(10,3-M);if(d<0||d>999)return null;break;case "ddd":case "dddd":Q=P;P=M===3;N=void 0;N=j.days;M=j._upperDays;if(!M)j._upperDays=M=[w(N.names),w(N.namesAbbr),w(N.namesShort)];Q=x(Q);if(P){N=o(M[1],Q);if(N===-1)N=o(M[2],
Q)}else N=o(M[0],Q);Q=N;if(Q<0||Q>6)return null;break;case "zzz":M=P.split(/:/);if(M.length!==2)return null;D=parseInt(M[0],10);if(D<-12||D>13)return null;M=parseInt(M[1],10);if(M<0||M>59)return null;D=D*60+(P.indexOf("-")===0?-M:M);break;case "z":case "zz":D=N;if(D<-12||D>13)return null;D*=60;break;case "g":case "gg":if(!P||!j.eras)return null;P=r(P.toLowerCase());M=0;for(N=j.eras.length;M<N;M++)if(P===j.eras[M].name.toLowerCase()){f=M;break}if(f===null)return null}}}n=new Date;y=(J=j.convert)?J.fromGregorian(n)[0]:
n.getFullYear();if(O===null)O=y;else if(j.eras)O+=j.eras[f||0].offset;if(K===null)K=0;if(l===null)l=1;if(J){n=J.toGregorian(O,K,l);if(n===null)return null}else{n.setFullYear(O,K,l);if(n.getDate()!==l)return null;if(Q!==null&&n.getDay()!==Q)return null}if(i&&u<12)u+=12;n.setHours(u,v,F,d);if(D!==null){j=n.getMinutes()-(D+n.getTimezoneOffset());n.setHours(n.getHours()+parseInt(j/60,10),j%60)}return n}function s(f,l,j){function u(M,N){var S;S=M+"";if(N>1&&S.length<N){S=J[N-2]+S;return S.substr(S.length-
N,N)}return S}function v(){if(L||O)return L;L=K.test(l);O=true;return L}function F(M,N){if(R)return R[N];switch(N){case 0:return M.getFullYear();case 1:return M.getMonth();case 2:return M.getDate()}}var d=j.calendar,i=d.convert;if(!l||!l.length||l==="i"){if(j&&j.name.length)if(i)j=s(f,d.patterns.F,j);else{j=new Date(f.getTime());var n=B(f,d.eras);j.setFullYear(g(f,d,n));j=j.toLocaleString()}else j=f.toString();return j}n=d.eras;var y=l==="s";l=C(d,l);j=[];var D,J=["0","00","000"],L,O,K=/([^d]|^)(d|dd)([^d]|$)/g,
Q=0,P=e(),R;if(!y&&i)R=i.fromGregorian(f);for(;;){D=P.lastIndex;i=P.exec(l);D=l.slice(D,i?i.index:l.length);Q+=I(D,j);if(!i)break;if(Q%2)j.push(i[0]);else{D=i[0];i=D.length;switch(D){case "ddd":case "dddd":j.push((i===3?d.days.namesAbbr:d.days.names)[f.getDay()]);break;case "d":case "dd":L=true;j.push(u(F(f,2),i));break;case "MMM":case "MMMM":D=F(f,1);j.push(d.monthsGenitive&&v()?d.monthsGenitive[i===3?"namesAbbr":"names"][D]:d.months[i===3?"namesAbbr":"names"][D]);break;case "M":case "MM":j.push(u(F(f,
1)+1,i));break;case "y":case "yy":case "yyyy":D=R?R[0]:g(f,d,B(f,n),y);if(i<4)D%=100;j.push(u(D,i));break;case "h":case "hh":D=f.getHours()%12;if(D===0)D=12;j.push(u(D,i));break;case "H":case "HH":j.push(u(f.getHours(),i));break;case "m":case "mm":j.push(u(f.getMinutes(),i));break;case "s":case "ss":j.push(u(f.getSeconds(),i));break;case "t":case "tt":D=f.getHours()<12?d.AM?d.AM[0]:" ":d.PM?d.PM[0]:" ";j.push(i===1?D.charAt(0):D);break;case "f":case "ff":case "fff":j.push(u(f.getMilliseconds(),3).substr(0,
i));break;case "z":case "zz":D=f.getTimezoneOffset()/60;j.push((D<=0?"+":"-")+u(Math.floor(Math.abs(D)),i));break;case "zzz":D=f.getTimezoneOffset()/60;j.push((D<=0?"+":"-")+u(Math.floor(Math.abs(D)),2)+":"+u(Math.abs(f.getTimezoneOffset()%60),2));break;case "g":case "gg":d.eras&&j.push(d.eras[B(f,n)].name);break;case "/":j.push(d["/"]);break;default:throw"Invalid date format pattern '"+D+"'.";}}}return j.join("")}var z={},h={en:{}};h["default"]=h.en;z.extend=function(f){for(var l=arguments[1]||{},
j=2,u=arguments.length;j<u;j++){var v=arguments[j];if(v)for(var F in v){var d=v[F];if(typeof d!=="undefined")if(f&&(m.call(d)==="[object Object]"||A(d))){var i=l[F];i=i&&(m.call(i)==="[object Object]"||A(i))?i:A(d)?[]:{};l[F]=this.extend(true,i,d)}else l[F]=d}}return l};z.findClosestCulture=function(f){var l;if(!f)return this.culture||this.cultures["default"];if(m.call(f)==="[object String]")f=f.split(",");if(A(f)){var j,u=this.cultures,v=f,F,d=v.length,i=[];for(F=0;F<d;F++){f=r(v[F]);f=f.split(";");
j=r(f[0]);if(f.length===1)f=1;else{f=r(f[1]);if(f.indexOf("q=")===0){f=f.substr(2);f=parseFloat(f,10);f=isNaN(f)?0:f}else f=1}i.push({lang:j,pri:f})}i.sort(function(y,D){return y.pri<D.pri?1:-1});for(F=0;F<d;F++){j=i[F].lang;if(l=u[j])return l}for(F=0;F<d;F++){j=i[F].lang;do{v=j.lastIndexOf("-");if(v===-1)break;j=j.substr(0,v);if(l=u[j])return l}while(1)}for(F=0;F<d;F++){j=i[F].lang;for(var n in u){v=u[n];if(v.language==j)return v}}}else if(typeof f==="object")return f;return l||null};z.preferCulture=
function(f){this.culture=this.findClosestCulture(f)||this.cultures["default"]};z.localize=function(f,l,j){if(typeof l!=="string")l=this.culture.name||this.culture||"default";l=this.cultures[l]||{name:l};var u=h[l.name];if(arguments.length===3){u||(u=h[l.name]={});u[f]=j}else{if(u)j=u[f];if(typeof j==="undefined"){if(u=h[l.language])j=u[f];if(typeof j==="undefined")j=h["default"][f]}}return typeof j==="undefined"?null:j};z.format=function(f,l,j){j=this.findClosestCulture(j);if(typeof f==="number"){var u=
f;if(!l||l==="i")f=j.name.length?u.toLocaleString():u.toString();else{l=l||"D";j=j.numberFormat;f=Math.abs(u);var v=-1;if(l.length>1)v=parseInt(l.slice(1),10);var F=l.charAt(0).toUpperCase(),d;switch(F){case "D":l="n";if(v!==-1)f=G(""+f,v,true);if(u<0)f=-f;break;case "N":d=j;case "C":d=d||j.currency;case "P":d=d||j.percent;l=u<0?d.pattern[0]:d.pattern[1]||"n";if(v===-1)v=d.decimals;b:{var i=f*(F==="P"?100:1);F=d;d=F.groupSizes;f=d[0];u=1;var n=Math.pow(10,v),y=Math.round(i*n)/n;isFinite(y)||(y=i);
n="";n=(y+"").split(/e/i);y=n.length>1?parseInt(n[1],10):0;i=n[0];n=i.split(".");i=n[0];n=n.length>1?n[1]:"";if(y>0){n=G(n,y,false);i+=n.slice(0,y);n=n.substr(y)}else if(y<0){y=-y;i=G(i,y+1);n=i.slice(-y,i.length)+n;i=i.slice(0,-y)}n=v>0?F["."]+(n.length>v?n.slice(0,v):G(n,v)):"";v=i.length-1;F=F[","];for(y="";v>=0;){if(f===0||f>v){f=i.slice(0,v+1)+(y.length?F+y+n:n);break b}y=i.slice(v-f+1,v+1)+(y.length?F+y:"");v-=f;if(u<d.length){f=d[u];u++}}f=i.slice(0,v+1)+F+y+n}break;default:throw"Bad number format specifier: "+
F;}d=/n|\$|-|%/g;for(u="";;){v=d.lastIndex;F=d.exec(l);u+=l.slice(v,F?F.index:l.length);if(!F)break;switch(F[0]){case "n":u+=f;break;case "$":u+=j.currency.symbol;break;case "-":if(/[1-9]/.test(f))u+=j["-"];break;case "%":u+=j.percent.symbol}}f=u}}else if(f instanceof Date)f=s(f,l,j);return f};z.parseInt=function(f,l,j){return Math.floor(this.parseFloat(f,l,j))};z.parseFloat=function(f,l,j){if(typeof l==="string"){j=l;l=10}j=this.findClosestCulture(j);var u=NaN,v=j.numberFormat;if(f.indexOf(j.numberFormat.currency.symbol)>
-1){f=f.replace(j.numberFormat.currency.symbol,"");f=f.replace(j.numberFormat.currency["."],j.numberFormat["."])}f=r(f);if(E.test(f))u=parseFloat(f,l);else if(!l&&a.test(f))u=parseInt(f,16);else{j=H(f,v,v.pattern[0]);l=j[0];j=j[1];if(l===""&&v.pattern[0]!=="-n"){j=H(f,v,"-n");l=j[0];j=j[1]}l=l||"+";var F;f=j.indexOf("e");if(f<0)f=j.indexOf("E");if(f<0){F=j;f=null}else{F=j.substr(0,f);f=j.substr(f+1)}var d=v["."],i=F.indexOf(d);if(i<0){j=F;F=null}else{j=F.substr(0,i);F=F.substr(i+d.length)}d=v[","];
j=j.split(d).join("");i=d.replace(/\u00A0/g," ");if(d!==i)j=j.split(i).join("");l+=j;if(F!==null)l+="."+F;if(f!==null){v=H(f,v,"-n");l+="e"+(v[0]||"+")+v[1]}if(c.test(l))u=parseFloat(l)}return u};z.parseDate=function(f,l,j){j=this.findClosestCulture(j);var u,v;if(l){if(typeof l==="string")l=[l];if(l.length){v=0;for(var F=l.length;v<F;v++){var d=l[v];if(d)if(u=q(f,d,j))break}}}else{l=j.calendar.patterns;for(v in l)if(u=q(f,l[v],j))break}return u||null};var k=z.cultures=z.cultures||{};k=k["default"]=
k.en=z.extend(true,{name:"en",englishName:"English",nativeName:"English",isRTL:false,language:"en",numberFormat:{pattern:["-n"],decimals:2,",":",",".":".",groupSizes:[3],"+":"+","-":"-",percent:{pattern:["-n %","n %"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"%"},currency:{pattern:["($n)","$n"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"$"}},calendars:{standard:{name:"Gregorian_USEnglish","/":"/",":":":",firstDay:0,days:{names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday",
"Saturday"],namesAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],namesShort:["Su","Mo","Tu","We","Th","Fr","Sa"]},months:{names:["January","February","March","April","May","June","July","August","September","October","November","December",""],namesAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""]},AM:["AM","am","AM"],PM:["PM","pm","PM"],eras:[{name:"A.D.",start:null,offset:0}],twoDigitYearMax:2029,patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",t:"h:mm tt",T:"h:mm:ss tt",
f:"dddd, MMMM dd, yyyy h:mm tt",F:"dddd, MMMM dd, yyyy h:mm:ss tt",M:"MMMM dd",Y:"yyyy MMMM",S:"yyyy'-'MM'-'dd'T'HH':'mm':'ss"}}}},k.en);k.calendar=k.calendar||k.calendars.standard;var p=/^\s+|\s+$/g,E=/^[+-]?infinity$/i,a=/^0x[a-f0-9]+$/i,c=/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/,m=Object.prototype.toString;jQuery.global=z})();timeglider=window.timeglider||{version:"0.1.0"};timeglider.TG_Date={};
(function(r){function G(e){return parseInt(e,10)}function A(e){var q=parseInt(e,10);return q>9||q<0?String(e):"0"+q}r=timeglider;var o=jQuery,H={},B={},x={},w={},g={},I=/^(\-?\d+)?(\-\d{1,2})?(\-\d{1,2})?(?:T| )?(\d{1,2})?(?::)?(\d{1,2})?(?::)?(\d{1,2})?(\+|\-)?(\d{1,2})?(?::)?(\d{1,2})?/;r.TG_Date=function(e,q,s){var z,h,k;s=s||0;if(typeof e=="number"){z=h=C.getDateFromSec(e);k=e+s}else if(typeof e!=="object"){if(e=="today")e=C.getToday();z=h=e}if(I.test(z)){e=C.parse8601(z);if(e.tz_ho)e=C.toFromUTC(e,
{hours:e.tz_ho,minutes:e.tz_mi},"to");o.extend(this,e);this.rd=C.getRataDie(this);this.mo_num=this.ye>0?(this.ye-1)*12+this.mo:-1*((Math.abs(this.ye)-1)*12+(12-(this.mo-1)));if(!k){k=Math.abs(this.rd)*86400;e=this.ho*3600;z=(this.mi-1)*60;s=1;if(this.rd<0)s=-1;k=s*(k+e+z)}this.sec=k;this.date_display=q?q.toLowerCase().substr(0,2):"da";this.dateStr=h}else return{error:"invalid date"};return this};var C=r.TG_Date;C.getTimeUnitSerial=function(e,q){var s=0;switch(q){case "da":s=e.rd;break;case "mo":s=
e.mo_num;break;case "ye":s=e.ye;break;case "de":s=Math.floor(e.ye/10);break;case "ce":s=Math.floor(e.ye/100);break;case "thou":s=Math.floor(e.ye/1E3);break;case "tenthou":s=Math.floor(e.ye/1E4);break;case "hundredthou":s=Math.floor(e.ye/1E5);break;case "mill":s=Math.floor(e.ye/1E6);break;case "tenmill":s=Math.floor(e.ye/1E7);break;case "hundredmill":s=Math.floor(e.ye/1E8);break;case "bill":s=Math.floor(e.ye/1E9)}return s};C.getMonthDays=function(e,q){return C.isLeapYear(q)==true&&e==2?29:C.monthsDayNums[e]};
C.twentyFourToTwelve=function(e){var q={};q.ye=e.ye;q.mo=e.mo;q.da=e.da;q.ho=e.ho;q.mi=e.mi;q.ampm="am";if(e.ho)if(e.ho>=12){q.ampm="pm";q.ho=e.ho>12?e.ho-12:12}else if(e.ho==0){q.ho=12;q.ampm="am"}else q.ho=e.ho;else{q.ho=12;q.mi=0;q.ampm="am"}return q};C.getMonthAdj=function(e,q){var s=C.getDateFromMonthNum(e);switch(s.mo){case 1:case 3:case 5:case 7:case 8:case 10:case 12:s=Math.floor(q+q/28*3);return{width:s,days:31};case 2:if(C.isLeapYear(s.ye)==true){s=Math.floor(q+q/28);return{width:s,days:29}}else return{width:q,
days:28};default:s=Math.floor(q+q/28*2);return{width:s,days:30}}};C.getDateFromMonthNum=function(e){var q=0;if(e>0){q=e%12;if(q==0)q=12;e=Math.ceil(e/12)}else{q=Math.abs(e)%12;q=12-q+1;if(q==13)q=1;e=-1*Math.ceil(Math.abs(e)/12)}return{ye:e,mo:q}};C.getMonthWidth=function(e,q,s){q=t/28;var z;switch(e){case 1:case 3:case 5:case 7:case 8:case 10:case 12:z=3;break;case 4:case 6:case 9:case 11:z=2;break;case 2:z=C.isLeapYear(yr)==true?1:0}return{width:Math.floor(s+q*z),numDays:28+z}};C.getToday=function(){var e=
new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":00"};C.getMonthFromRemDays=function(e,q){var s=0;var z=s=0;s=C.isLeapYear(q)?1:0;if(e<=31){z=1;s=e}else if(e>31&&e<=59+s){z=2;s=e-(31+s)}else if(e>59+s&&e<=90+s){z=3;s=e-(59+s)}else if(e>90+s&&e<=120+s){z=4;s=e-(90+s)}else if(e>120+s&&e<=151+s){z=5;s=e-(120+s)}else if(e>151+s&&e<=181+s){z=6;s=e-(151+s)}else if(e>181+s&&e<=212+s){z=7;s=e-(181+s)}else if(e>212+s&&e<=243+s){z=8;s=e-(212+s)}else if(e>
243+s&&e<=273+s){z=9;s=e-(243+s)}else if(e>273+s&&e<=304+s){z=10;s=e-(273+s)}else if(e>304+s&&e<=334+s){z=11;s=e-(304+s)}else{z=12;s=e-(334+s)}return{mo:z,da:s}};C.getDateFromRD=function(e){if(w[e])return w[e];for(var q=Math.floor(e),s=Math.floor(q/146097)*400,z=q-Math.floor(q/146097)*146097,h=1,k=s+1,p=k+400;k<=p;k++)if(z>365){z-=365;if(C.isLeapYear(k))z-=1;h++}else k=p;s+=h;if(z==0)z=1;z=C.getMonthFromRemDays(z,s);h=(e-q)*1440;q=Math.floor(h%60);h=Math.floor(h/60);if(C.isLeapYear(s)&&z.mo==2)z.da+=
1;q=s+"-"+z.mo+"-"+z.da+" "+h+":"+q+":00";return w[e]=q};C.getDateFromSec=function(e){if(g[e])return g[e];var q=C.getDateFromRD(e/86400);return g[e]=q};C.isLeapYear=function(e){return e%400==0?true:e%100==0?false:e%4==0?true:false};C.getRataDie=function(e){function q(a,c){if(B[a+"-"+c])return B[a+"-"+c];for(var m=0,f=a;f<c;f++)m+=C.isLeapYear(f)?366:365;return B[a+"-"+c]=m}function s(a,c){var m;switch(a){case 1:m=0;break;case 2:m=31;break;case 3:m=59;break;case 4:m=90;break;case 5:m=120;break;case 6:m=
151;break;case 7:m=181;break;case 8:m=212;break;case 9:m=243;break;case 10:m=273;break;case 11:m=304;break;case 12:m=334}if(a>2)if(C.isLeapYear(c))m+=1;return m}var z=e.ye,h=e.mo;e=e.da;var k=0;if(H[z+"-"+h+"-"+e])return H[z+"-"+h+"-"+e];if(z>=0){if(z==0)z=1;k=Math.floor(z/400)*146097;var p=parseInt(q(z-z%400,z)),E=parseInt(s(h,z));k=k+p+E+e-366}else if(z<0)k=C.getBCRataDie({ye:z,mo:h,da:e});return H[z+"-"+h+"-"+e]=k};C.monthNamesLet=["","J","F","M","A","M","J","J","A","S","O","N","D"];C.monthsDayNums=
[0,31,28,31,30,31,30,31,31,30,31,30,31,29];C.units=["da","mo","ye","de","ce","thou","tenthou","hundredthou","mill","tenmill","hundredmill","bill"];C.getBCRataDie=function(e){var q=e.ye,s=e.mo;e=e.da;if(x[q+"-"+s+"-"+e])return x[q+"-"+s+"-"+e];if(s==0)s=1;if(e==0)e=1;var z=-1*((Math.abs(q)-1)*366+[0,335,306,275,245,214,184,153,122,92,61,31,0][s]+(C.monthsDayNums[s]-e+1));return x[q+"-"+s+"-"+e]=z};C.setCulture=function(e){jQuery.global.culture=jQuery.global.cultures[e];C.monthNames=o.merge([""],jQuery.global.culture.calendar.months.names);
C.monthNamesAbbr=o.merge([""],jQuery.global.culture.calendar.months.namesAbbr);C.dayNames=jQuery.global.culture.calendar.days.names;C.dayNamesAbbr=jQuery.global.culture.calendar.days.namesAbbr;C.dayNamesShort=jQuery.global.culture.calendar.days.namesShort;C.patterns=jQuery.global.culture.calendar.patterns};C.prototype={format:function(e,q,s){s=s||{hours:0,minutes:0};if(q==true)switch(this.date_display.substr(0,2)){case "no":return"";case "ye":e="yyyy";break;case "mo":e="MMM yyyy";break;case "da":e=
"MMM d, yyyy";break;case "ho":e="MMM d, yyyy h:mm tt";break;default:e="f"}if(this.ye>-27E4){q=C.toFromUTC(_.clone(this),s,"from");q=new Date(q.ye,q.mo-1,q.da,q.ho,q.mi,q.se,0);return o.global.format(q,e)}else return this.ye}};C.getTimeOffset=function(e){e=e.replace(/[^-\d:]/gi,"");var q=e.split(":"),s=parseInt(q[0],10);q=parseInt(q[1],10);var z=s+(s<0?-1:1)*(q/60);return{decimal:z,hours:s,minutes:q,seconds:z*3600,string:e}};C.tzOffsetStr=function(e,q){if(e){if(e.length==19)e+=q;else if(e.length==
16)e+=":00"+q;return e}};C.parse8601=function(e){var q,s,z,h,k;k=function(E){return E?parseInt(E.replace("-",""),10):0};var p=e.match(I);e=parseInt(p[1]);if(!e)return{error:"invalid date; no year provided"};q=k(p[2])||1;s=k(p[3])||1;z=k(p[4])||1;h=k(p[5])||0;k=k(p[6])||0;tz_pm=p[7]||"+";tz_ho=parseInt(p[8],10)||0;if(tz_pm=="-")tz_ho*=-1;tz_mi=parseInt(p[9],10)||0;if(tz_pm=="-")tz_mi*=-1;return{ye:e,mo:q,da:s,ho:z,mi:h,se:k,tz_ho:tz_ho,tz_mi:tz_mi}};C.getLastDayOfMonth=function(e,q){var s=[0,31,28,
31,30,31,30,31,31,30,31,30,31],z=0;return z=q==2&&C.isLeapYear(e)==true?29:s[q]};C.getDateTimeStrings=function(e){var q=C.parse8601(e);e=q.ye+"-"+A(q.mo)+"-"+A(q.da);var s="pm";if(q.ho>12){q.ho-=12;s="pm"}else{if(q.ho==0)q.ho="12";s="am"}q=G(q.ho)+":"+A(q.mi)+" "+s;return{date:e,time:q}};C.transValidateDateString=function(e){if(!e)return false;var q=e.match(/^(\-?\d+|today|now) ?(bce?)?-?(\d{1,2})?-?(\d{1,2})?/);zb=C.zeroButt;if(q){e=q[1];var s=q[2]||"",z=q[3]||"07";q=q[4]||"1";debug.log("bc:",s);
if(parseInt(e,10)<0||s.substr(0,1)=="b")e=-1*Math.abs(e);return C.validateDate(e,z,q)?e+"-"+zb(z)+"-"+zb(q):false}else return false};C.transValidateTimeString=function(e){if(!e)return"12:00:00";e=e.toLowerCase().match(/^(\d{1,2}|noon):?(\d{1,2})?:?(\d{1,2})? ?(am|pm)?/i);var q="";q=C.zeroButt;if(e[1])if(e[0]=="noon")q="12:00:00";else{var s=parseInt(e[1],10)||12,z=parseInt(e[2],10)||0,h=parseInt(e[3],10)||0;e=e[4]||"am";if(C.validateTime(s,z,h)==false)return false;if(e=="pm"&&s<12)s+=12;q=q(s)+":"+
q(z)+":"+q(h)}else q=false;return q};C.validateTime=function(e,q,s){if(e<0||e>23||q<0||q>59||s<0||s>59)return false;return true};C.validateDate=function(e,q,s){var z=C.getMonthDays(q,e);if(s>z||s<=0)return false;if(q>12||q<0)return false;if(e==0)return false;return true};C.zeroButt=function(e){e=parseInt(e,10);return e>9?String(e):"0"+e};C.toFromUTC=function(e,q,s){var z=0,h=[0,31,28,31,30,31,30,31,31,30,31,30,31,29];z={};if(s=="from"){z.ho=-1*q.hours;z.mi=-1*q.minutes}else if(s=="to"){z.ho=q.hours;
z.mi=q.minutes}else{z.ho=-1*e.tz_ho;z.mi=-1*e.tz_mi}if(z.ho==0&&z.mi==0)return e;s=e.ho+e.mi/60+(-1*z.ho+z.mi*-1/60);if(s<0){z=24+s;if(e.da>1)e.da-=1;else if(e.mo==1){e.ye-=1;e.mo=12;e.da=31}else{e.mo-=1;e.da=C.getLastDayOfMonth(e.ye,e.mo)}}else if(s>=24){z=s-24;if(C.isLeapYear(e.ye)&&e.mo==2&&e.da==28)e.da=29;else if(e.da==h[e.mo]){if(e.mo==12){e.ye+=1;e.mo=1}else e.mo+=1;e.da=1}else e.da+=1}else z=s;h=function(k){k=Math.abs(k);var p=Math.floor(k);return{ho:p,mi:Math.round((k-p)*60),se:0}}(z);e.ho=
h.ho;e.mi=h.mi;if(q){e.tz_ho=q.tz_ho;e.tz_mi=q.tz_mi}else{e.tz_ho=0;e.tz_mi=0}return{ye:e.ye,mo:e.mo,da:e.da,ho:e.ho,mi:e.mi,se:e.se}};C.timezones=[{offset:"-12:00",name:"Int'l Date Line West"},{offset:"-11:00",name:"Bering & Nome"},{offset:"-10:00",name:"Alaska-Hawaii Standard Time"},{offset:"-10:00",name:"U.S. Hawaiian Standard Time"},{offset:"-10:00",name:"U.S. Central Alaska Time"},{offset:"-09:00",name:"U.S. Yukon Standard Time"},{offset:"-08:00",name:"U.S. Pacific Standard Time"},{offset:"-07:00",
name:"U.S. Mountain Standard Time"},{offset:"-07:00",name:"U.S. Pacific Daylight Time"},{offset:"-06:00",name:"U.S. Central Standard Time"},{offset:"-06:00",name:"U.S. Mountain Daylight Time"},{offset:"-05:00",name:"U.S. Eastern Standard Time"},{offset:"-05:00",name:"U.S. Central Daylight Time"},{offset:"-04:00",name:"U.S. Atlantic Standard Time"},{offset:"-04:00",name:"U.S. Eastern Daylight Time"},{offset:"-03:30",name:"Newfoundland Standard Time"},{offset:"-03:00",name:"Brazil Standard Time"},{offset:"-03:00",
name:"Atlantic Daylight Time"},{offset:"-03:00",name:"Greenland Standard Time"},{offset:"-02:00",name:"Azores Time"},{offset:"-01:00",name:"West Africa Time"},{offset:"00:00",name:"Greenwich Mean Time/UTC"},{offset:"00:00",name:"Western European Time"},{offset:"01:00",name:"Central European Time"},{offset:"01:00",name:"Middle European Time"},{offset:"01:00",name:"British Summer Time"},{offset:"01:00",name:"Middle European Winter Time"},{offset:"01:00",name:"Swedish Winter Time"},{offset:"01:00",name:"French Winter Time"},
{offset:"02:00",name:"Eastean EU"},{offset:"02:00",name:"USSR-zone1"},{offset:"02:00",name:"Middle European Summer Time"},{offset:"02:00",name:"French Summer Time"},{offset:"03:00",name:"Baghdad Time"},{offset:"03:00",name:"USSR-zone2"},{offset:"03:30",name:"Iran"},{offset:"04:00",name:"USSR-zone3"},{offset:"05:00",name:"USSR-zone4"},{offset:"05:30",name:"Indian Standard Time"},{offset:"06:00",name:"USSR-zone5"},{offset:"06:30",name:"North Sumatra Time"},{offset:"07:00",name:"USSR-zone6"},{offset:"07:00",
name:"West Australian Standard Time"},{offset:"07:30",name:"Java"},{offset:"08:00",name:"China & Hong Kong"},{offset:"08:00",name:"USSR-zone7"},{offset:"08:00",name:"West Australian Daylight Time"},{offset:"09:00",name:"Japan"},{offset:"09:00",name:"Korea"},{offset:"09:00",name:"USSR-zone8"},{offset:"09:30",name:"South Australian Standard Time"},{offset:"09:30",name:"Central Australian Standard Time"},{offset:"10:00",name:"Guam Standard Time"},{offset:"10:00",name:"USSR-zone9"},{offset:"10:00",name:"East Australian Standard Time"},
{offset:"10:30",name:"Central Australian Daylight Time"},{offset:"10:30",name:"South Australian Daylight Time"},{offset:"11:00",name:"USSR-zone10"},{offset:"11:00",name:"East Australian Daylight Time"},{offset:"12:00",name:"New Zealand Standard Time"},{offset:"12:00",name:"Int'l Date Line East"},{offset:"13:00",name:"New Zealand Daylight Time"}];C.boil=G;C.unboil=A})(timeglider);(function(r){var G=r.levelHeight=12;r.TG_Org=function(){var A=this,o=r.icon_folder;this.blocks=[];this.ids=[];this.vis=[];this.tree=[];this.pol=-1;this.addBlock=function(w,g){w.right=w.left+w.width;w.bottom=w.top+w.height;w.tickScope=g;A.blocks.push(w)};this.getBorg=function(){return this};this.getBlocks=function(){return this.blocks};this.getHTML=function(w,g){if(w=="sweep"){H();this.vis=[]}this.blocks.sort(B);var I,C,e="",q="";html="";south_padding=0;b={};blength=this.blocks.length;b_span_color=
"";highest=title_adj=0;guageHighest=function(z){highest=z>highest?z:highest};for(var s=0;s<blength;s++){b=this.blocks[s];title_adj=0;if(b.tickScope==w)if(_.indexOf(b.id,this.vis)==-1){this.vis.push(b.id);if(b.html&&b.html.substr(0,4)=="<div")html+="<div style='left:"+b.left+"px' id='"+b.id+"'"+b.html.substr(4);else{if(b.image){if(b.image.display_class!="above"){img_scale=(b.image.scale||100)/100;if(img_scale<1){b.image_width=img_scale*b.image.width;b.image_height=img_scale*b.image.height;img_style=
" style='width:"+b.image_width+"px;height:auto' "}else{img_style="";b.image_width=b.image.width;b.image_height=b.image.height}title_adj=b.image_height+4}else img_style="";e="<div class='timeglider-event-image-"+b.image.display_class+"'><img src='"+b.image.src+"' "+img_style+"></div>"}else e="";if(b.y_position>0)b.top=A.pol*b.y_position;else x(b,0);guageHighest(Math.abs(b.top));b_span_color=b.span_color?";background-color:"+b.span_color:"";b.fontsize<10?b.opacity=b.fontsize/10:b.opacity=1;if(b.span==
true){I="timeglider-event-spanning";C="<div class='timeglider-event-spanner' style='top:px;height:"+b.fontsize+"px;width:"+b.spanwidth+"px"+b_span_color+"'></div>"}else C=I="";q=b.icon?"<img class='timeglider-event-icon' src='"+o+b.icon+"' style='height:"+b.fontsize+"px;left:-"+(b.fontsize+2)+"px; top:"+title_adj+"px'>":"";if(g&&A.pol==-1&&Math.abs(b.top)>g-16)html+="<div class='timeglider-more-plus' style='left:"+b.left+"px; top:-"+(g-Math.floor(16/3))+"px'>+</div>";else{south_padding=A.pol===1?
42:0;html+="<div class='timeglider-timeline-event "+b.css_class+" "+I+"' id='"+b.id+"' style='width:"+b.width+"px;height:"+b.height+"px;left:"+b.left+"px;opacity:"+b.opacity+";top:"+(b.top+south_padding)+"px;font-size:"+b.fontsize+"px;'>"+q+e+C+"<div class='timeglider-event-title' style='top:"+title_adj+"px'>"+b.title+"</div></div>"}}}}return{html:html,highest:highest}};var H=function(){A.tree=[];for(var w=0;w<300;w++)A.tree[w]=[]},B=function(w,g){var I=g.importance,C=w.importance;return I<C?-1:I>
C?1:0},x=function(w,g){var I=false,C=A.tree,e=C[g],q=g+1,s=false,z=2;if(e!=undefined){for(z=0;z<e.length;z++){a:{I=e[z];if(!(w.left>I.right||w.right<I.left))if(w.left>=I.left&&w.left<=I.right||w.right>=I.left&&w.right<=I.right||w.right>=I.right&&w.left<=I.left||w.right<=I.right&&w.left>=I.left)if(w.bottom<=I.bottom&&w.bottom>=I.top||w.top<=I.bottom&&w.top>=I.top||w.top==I.bottom&&w.top==I.top){I=true;break a}I=false}if(I==true){if(A.pol===-1){w.top-=G;w.bottom-=G}else{w.top+=G;w.bottom+=G}x(w,q);
s=true;break}}if(s==false){if(A.pol===-1)w.top-=w.fontsize;else w.top+=w.fontsize;e.push(w);if(typeof w.shape==="object"){e=q=s=0;s=Math.ceil(w.shape.ev_ht/G);for(q=1;q<=s;q++){e=g+q;C[e].push(w)}q=Math.ceil(w.shape.img_ht/G);s={left:w.left,right:w.left+w.image.width+32,top:w.top,bottom:w.bottom};for(z=1;z<=q;z++)C[e+z].push(s)}else{z=Math.ceil(w.height/G);for(q=1;q<=z;q++)C[g+q].push(w)}}}}}})(timeglider);(function(r){var G=r.TG_Date,A=jQuery,o=G.units,H;r.TG_EventCollection=Backbone.Collection.extend({eventHash:{},setTimelineHash:function(B,x){this.eventHash[B]=x},getTimelineHash:function(B){return this.eventHash[B]},model:r.TG_Event});r.TG_Event=Backbone.Model.extend({urlRoot:"/event",defaults:{title:"Untitled"},initialize:function(B){if(B.image){if(typeof B.image=="string")B.image={id:B.id,src:B.image,display_class:B.image_class||"above",width:0,height:0};else{B.image.display_class=B.image.display_class||
"above";B.image.width=0;B.image.height=0}this.getEventImageSize(B.image)}else B.image="";B.titleWidth=r.getStringWidth(B.title);this.set(B)},validate:function(){},getEventImageSize:function(B){function x(I,C){return function(){return C.apply(I,arguments)}}var w=this,g=new Image;g.src=B.src;g.onerror=x(g,function(){});g.onload=x(g,function(){w.get("image").height=this.height;w.get("image").width=this.width})}});r.TG_TimelineCollection=Backbone.Collection.extend({model:r.TG_Timeline});r.TG_Timeline=
Backbone.Model.extend({urlRoot:"/timeline",defaults:{initial_zoom:25,focus_date:"today",timezone:"00:00",title:"Untitled",events:[],legend:[]},_chewTimeline:function(B){H=B.mediator;B.timeline_id=B.id;var x={all:[],da:[],mo:[],ye:[],de:[],ce:[],thou:[],tenthou:[],hundredthou:[],mill:[],tenmill:[],hundredmill:[],bill:[]};B.spans={};B.hasImagesAbove=false;B.startSeconds=[];B.endSeconds=[];B.focusDateObj=new G(B.focus_date);B.size_importance=B.size_importance=="false"?false:true;B.timeOffset=G.getTimeOffset(B.timezone||
"00:00");if(!B.color)B.color="#333333";if(B.events.length>0){for(var w,g,I,C,e=B.events.length,q=0;q<e;q++){g=B.events[q];if(g.id)I=g.id;else g.id=I="anon"+this.anonEventId++;if(g.map)if(H.main_map){if(timeglider.mapping.ready)g.map.marker_instance=timeglider.mapping.addAddMarkerToMap(g,H.main_map)}else r.googleMapsLoad();w=g.date_display||g.date_limit||"da";g.date_display=w.toLowerCase().substr(0,2);if(B.timeOffset.seconds){g.startdate=G.tzOffsetStr(g.startdate,B.timeOffset.string);if(g.enddate)g.enddate=
G.tzOffsetStr(g.enddate,B.timeOffset.string)}g.startdateObj=new G(g.startdate,g.date_display);if(g.enddate&&g.enddate!==g.startdate){g.enddateObj=new G(g.enddate,g.date_display);g.span=true;B.spans["s_"+g.id]={id:g.id,start:g.startdateObj.sec,end:g.enddateObj.sec}}else{g.enddateObj=g.startdateObj;g.span=false}if(g.image)if(g.image.display_class!="inline")B.hasImagesAbove=true;B.startSeconds.push(g.startdateObj.sec);B.endSeconds.push(g.enddateObj.sec);g.cache={span:g.span,startdateObj:_.clone(g.startdateObj),
enddateObj:_.clone(g.enddateObj)};g.icon=!g.icon||g.icon==="none"?"":g.icon;x.all.push(I);for(var s=o.length,z=0;z<s;z++){w=o[z];C=G.getTimeUnitSerial(g.startdateObj,w);if(x[w][C]!==undefined)x[w][C].push(I);else x[w][C]=[I]}if(H.eventCollection.get(I))H.eventCollection.get(I).get("timelines").push(B.timeline_id);else{g.timelines=[B.timeline_id];g=new r.TG_Event(g);H.eventCollection.add(g)}}e=A.merge(B.startSeconds,B.endSeconds);e=_.sortBy(e,function(h){return parseInt(h)});B.bounds={first:_.first(e),
last:_.last(e)};B.has_events=true}else B.has_events=false;B.hasLegend=B.legend.length>0?true:false;B.display="expanded";H.eventCollection.setTimelineHash(B.timeline_id,x);delete B.events;return B},initialize:function(B){B=this._chewTimeline(B);debug.log("processed:",B);this.set(B);this.bind("change",function(){})}})})(timeglider);(function(r){var G=r.TG_Date,A="",o="",H={},B=0,x=0,w=0,g=jQuery,I={},C="",e,q,s,z=g.support.touch?"touchstart":"click";r.TG_PlayerView=function(h,k){var p=this;o=k;H=o.options;A="#"+h._id;C=h._id;this._views={PLACE:A,CONTAINER:A+" .timeglider-container",DATE:A+" .timeglider-date-display",TIMELINE_MENU:A+" .timeglider-timeline-menu",TIMELINE_MENU_UL:A+" .timeglider-timeline-menu ul",TIMELINE_LIST_BT:A+" .timeglider-list-bt",SLIDER_CONTAINER:A+" .timeglider-slider-container",SLIDER:A+" .timeglider-slider",
ZOOM_DISPLAY:A+" .timeglider-zoomlevel-display",TRUCK:A+" .timeglider-truck",CENTERLINE:A+" .timeglider-centerline",TICKS:A+" .timeglider-ticks",HANDLE:A+" .timeglider-handle",FOOTER:A+" .timeglider-footer",FILTER_BT:A+" .timeglider-filter-bt",FILTER_BOX:A+" .timeglider-filter-box",SETTINGS_BT:A+" .timeglider-settings-bt"};e=this._views.CONTAINER;q=this._views.TICKS;s=this._views.DATE;this.initTimelineVOffset=100;this.tick_height=34;this.imageLaneHeight=60;this._templates={};this._templates={test:"testola",
event_modal_small:"<div class='tg-modal timeglider-ev-modal ui-widget-content' id='${id}_modal'><div class='close-button-remove'></div><div class='dateline'>{{html dateline}}</div><h4 id='title'>${title}</h4><p>{{html image}}{{html description}}</p><ul class='timeglider-ev-modal-links'>{{html links}}</ul></div>",event_modal_full:g.template(null,"<div class='tg-modal full_modal' id='ev_${id}_modal'><div class='full_modal_scrim'></div><div class='full_modal_panel'><div class='close-button full_modal_close'>x</div><div class='dateline'>{{html dateline}}</div><table><tr><td><h4>${title}</h4><div class='description'><p>{{html description}}</p></div></td><td><div>{{html image}}</div><div id='insert'></div></td></tr></table><div class='footer'><ul>{{html links}}</ul></div></div>"),
filter_modal:g.template(null,"<div class='tg-modal timeglider-menu-modal timeglider-filter-box'><div class='close-button'></div><h3>filter</h3><div class='timeglider-menu-modal-content'><div class='timeglider-formline'>show: <input type='text' class='timeglider-filter-include'></div><div class='timeglider-formline'>hide: <input type='text' class='timeglider-filter-exclude'></div><ul><li class='timeglider-filter-clear'>clear</li><li class='timeglider-filter-apply'>apply</li></ul></div><div class='timeglider-menu-modal-point-right'></div>"),
timeline_list_modal:g.template(null,"<div class='timeglider-menu-modal timeglider-timeline-menu'><div class='close-button'></div><h3>timelines</h3><div class='timeglider-menu-modal-content'><ul></ul></div><div class='timeglider-menu-modal-point-right'></div>"),settings_modal:g.template(null,"<div class='timeglider-menu-modal timeglider-settings-modal'><div class='close-button'></div><h3>settings</h3><div class='timeglider-menu-modal-content'><div class='timeglider-settings-timezone'></div></div><div class='timeglider-menu-modal-point-right'></div>"),
legend_modal:g.template(null,"<div class='timeglider-menu-modal timeglider-legend timeglider-display-none'  id='${id}_legend'><div class='timeglider-menu-modal-content'><ul id='${id}'>{{html legend_list}}</ul><div class='timeglider-close-button-small timeglider-legend-close'></div><div class='timeglider-legend-all'>all</div></div></div>")};this.timelineModal=r.TG_TimelineView.extend({tagName:"div",model:r.TG_Timeline,className:"tg-modal timeglider-timeline-modal ui-widget-content",events:{"click .close-button-remove":"remove"},
template:"<div class='close-button-remove'></div><h4 id='title'>${title}</h4><p>{{html description}}</p>",initialize:function(){this.model.bind("change",this.render,this)},render:function(){g(this.el).html(g.tmpl(this.template,this.model.attributes)).attr("id",this.model.get("id")+"_timelineModal");return this},remove:function(){g(this.el).fadeOut()}});g(e).delegate(".tg-timeline-envelope .timeline-info","click",function(){var a=g(this).data("timeline_id");p.openTimelineModal(a)}).delegate(".tg-timeline-envelope .expand-collapse",
"click",function(){var a=g(this).data("timeline_id");p.expandCollapseTimeline(a)}).delegate(".tg-timeline-envelope .tg-timeline-legend-bt","click",function(){var a=g(this).data("timeline_id");p.legendModal(a)}).delegate(".close-button-remove","click",function(){var a=g(this).parent().attr("id");g("#"+a).remove()}).delegate(".full_modal_scrim, .full_modal_close","click",function(){g(".full_modal").remove()}).delegate(".timeglider-more-plus","click",function(){o.zoom(-1)}).delegate(".timeglider-legend-close",
"click",function(){var a=g(e+" .timeglider-legend");a.fadeOut(300,function(){a.remove()})}).delegate(".timeglider-legend-all","click",function(){g(e+" .timeglider-legend li").each(function(){g(this).removeClass("tg-legend-icon-selected")});o.setFilters({origin:"legend",icon:"all"})}).css("height",g(A).height());this.basicFontSize=H.basic_fontsize;H.show_footer==false&&g(this._views.FOOTER).css("display","none");this.dragSpeed=0;this.dimensions=o.dimensions=this.getWidgetDimensions();this.ticksHandleOffset=
this.rightside=this.leftside=this.tickNum=0;this.timeoout_id=1;this.sliderActive=false;this.ztop=1E3;this.filterBoxActivated=false;this.buildSlider();this.setupFilter();this.setPanButton(g(".timeglider-pan-right"),-30);this.setPanButton(g(".timeglider-pan-left"),30);g(this._views.TRUCK).bind("dblclick",function(a){o.registerUIEvent({name:"dblclick",event:a,dimensions:p.dimensions})}).bind("mousewheel",function(a,c){var m=Math.ceil(-1*c*3),f=o.getZoomLevel();o.setZoomLevel(f+m);return false});g(q).draggable({axis:"x",
start:function(){},drag:function(){x=Math.floor(g(this).position().left);o.setTicksOffset(x);B=x-w;w=x},stop:function(){debug.trace("::||"+B,"note");p.resetTicksHandle();p.registerDragging()}}).delegate(e+" .timeglider-timeline-event",z,function(){var a=g(this).attr("id"),c=o.eventCollection.get(a).attributes;debug.log("event id on touchstart/click:"+a);if(timeglider.mode!="authoring")if(c.click_callback){a=c.click_callback.split(".");var m=a.length;if(m==1)window[a[0]](c);else if(m==2)window[a[0]][a[1]](c);
else if(m==3)window[a[0]][a[1]][a[2]](c)}else p.eventModal(a)}).delegate(".timeglider-timeline-event","mouseover",function(){var a=o.eventCollection.get(g(this).attr("id")).attributes;p.eventHover(g(this),a)}).delegate(".timeglider-timeline-event","mouseout",function(){var a=o.eventCollection.get(g(this).attr("id")).attributes;p.eventUnHover(g(this),a)}).delegate(".timeglider-event-collapsed","hover",function(){o.eventCollection.get(g(this).attr("id"))});p.setCenterline();g.subscribe("mediator.ticksOffsetChange",
function(){p.tickHangies();p.registerDragging();p.registerTitles()});g.subscribe("mediator.focusToEvent",function(){});g.subscribe("mediator.zoomLevelChange",function(){p.tickNum=0;p.leftside=0;var a=o.getZoomLevel();g(p._views.SLIDER).slider("value",p.invSliderVal(a));p.displayZoomLevel(a);p.castTicks("zoomLevelChange")});g.subscribe("viewer.rendered",function(){});g.subscribe("mediator.ticksReadySignal",function(){o.ticksReady===true&&p.freshTimelines()});g.subscribe("mediator.refreshSignal",function(){p.tickNum=
0;p.leftside=0;p.castTicks("refreshSignal")});g.subscribe("mediator.ticksArrayChange",function(){});g.subscribe("mediator.focusDateChange",function(){this.displayFocusDate()});g.subscribe("mediator.timelineDataLoaded",function(){g(".timeglider-loading").fadeOut(500);p.buildSettingsMenu();p.buildTimelineMenu()});g.subscribe("mediator.activeTimelinesChange",function(){g(p._views.TIMELINE_MENU_UL+" li").each(function(){var a=g(this).data("timeline_id");g.inArray(a,o.activeTimelines)!=-1?g(this).addClass("activeTimeline"):
g(this).removeClass("activeTimeline")})});g.subscribe("mediator.filterChange",function(){});if(g.support.touch){g("#"+C).addTouch();var E=document.getElementById(C);E.addEventListener("gesturestart",function(a){a.preventDefault();g("#output").append("<br>gesture zoom:"+o.getZoomLevel())},false);E.addEventListener("gestureend",function(a){a.preventDefault();g("#output").append("<br>gesture end:"+o.getZoomLevel())},false);E.addEventListener("gesturechange",function(a){a.preventDefault();a.preventDefault();
if(o.gesturing===false){o.gesturing=true;o.gestureStartZoom=o.getZoomLevel()}o.setZoomLevel(Math.ceil(o.gestureStartZoom/a.scale))},false)}};r.TG_PlayerView.prototype={resize:function(){var h=g(A).height();g(e).height(h);this.dimensions=this.getWidgetDimensions();o.setDimensions(this.dimensions);this.setCenterline();o.refresh()},getWidgetDimensions:function(){var h=g(e),k=h.width(),p=Math.floor(k/2)+1,E=h.height(),a=Math.floor(E/2),c=this.tick_height,m=h.position().left;h=h.offset();var f=H.show_footer==
true?g(this._views.FOOTER).height():0;return{container:{width:k,height:E,centerx:p,centery:a,left:m,offset:h},tick:{top:E-f-c},footer:{height:f}}},scaleToImportance:function(h,k){return h/k},displayZoomLevel:function(){var h=o.getZoomLevel();h>0&&H.display_zoom_level==true&&g(this._views.ZOOM_DISPLAY).text(h)},displayFocusDate:function(){var h=o.getFocusDate();g(s).text(h.format("d MMM yyyy",false))},setPanButton:function(h,k){var p=this;g(h).live("mousedown",function(){p.intervalMachine("pan",{type:"set",
fn:p.pan,args:[k],intvl:33})}).live("mouseup",function(){p.intervalMachine("pan",{type:"clear",fn:p.pan,callback:"resetTicksHandle"})}).live("mouseout",function(){p.intervalMachine("pan",{type:"clear",fn:p.pan,callback:"resetTicksHandle"})})},intervalMachine:function(h,k){var p=this;if(k.type==="clear"){clearInterval(I[h]);if(k.callback)p[k.callback]()}else I[h]=setInterval(function(){k.fn.apply(p,k.args)},k.intvl)},invSliderVal:function(h){return Math.abs(h-101)},pan:function(h){h=h||20;$t=g(q);
newPos=$t.position().left+h;$t.css({left:newPos});o.setTicksOffset(newPos)},registerTitles:function(){var h,k,p,E,a,c,m,f,l,j=g(e).offset().left;g(".timeglider-event-spanning").each(function(){h=g(this).offset().left-j;k=g(this).outerWidth();c=g(".timeglider-event-title",this);p=c.outerWidth()+5;E=c.siblings(".timeglider-event-spanner").outerWidth();E>p&&h<0&&Math.abs(h)<k-p&&c.css({marginLeft:-1*h+5})});g.browser.msie&&parseInt(g.browser.version);g(".tg-timeline-envelope").each(function(){m=g(this);
f=m.offset().left-j;$tb=m.find(".titleBar");a=$tb.data("lef");l=-1*(a+f);$ti=$tb.find(".timeline-title");l>0&&l<$tb.width()-$ti.width()&&$ti.css({marginLeft:l+5})})},registerDragging:function(){var h=o.startSec,k=g(q).position().left,p=o.getZoomInfo().spp;h=new G(h-k*p);o.setFocusDate(h);this.displayFocusDate()},setupFilter:function(){var h=this;$filter=g.tmpl(h._templates.filter_modal,{}).appendTo(h._views.CONTAINER);$filter.css("z-index",h.ztop++).position({my:"right bottom",at:"right top",of:g(h._views.FILTER_BT),
offset:"-8, -12"}).hide();g(e).delegate(".timeglider-filter-box .close-button","click",function(){$filter.fadeOut()});g(h._views.FILTER_BT).bind("click",function(){$filter.fadeIn();g(this);var k=h._views.FILTER_BOX;if(h.filterBoxActivated==false){h.filterBoxActivated=true;var p=g(k+" .timeglider-filter-apply"),E=g(".timeglider-filter-box .close-button"),a=g(k+" .timeglider-filter-clear"),c="",m="";p.bind("click",function(){c=g(k+" .timeglider-filter-include").val();m=g(k+" .timeglider-filter-exclude").val();
o.setFilters({origin:"clude",include:c,exclude:m});g(k).toggleClass("timeglider-display-block")});E.bind("click",function(){g(k).toggleClass("timeglider-display-none")});a.bind("click",function(){o.setFilters({origin:"clude",include:"",exclude:""});g(k+" .timeglider-filter-include").val("");g(k+" .timeglider-filter-exclude").val("");g(k).toggleClass("timeglider-display-block")})}})},buildTimelineMenu:function(){var h=this,k;g(h._views.TIMELINE_LIST_BT);g(h._views.TIMELINE_MENU)[0]&&g(h._views.TIMELINE_MENU).remove();
k=g.tmpl(h._templates.timeline_list_modal,{}).appendTo(h._views.CONTAINER);var p=Backbone.View.extend({initialize:function(){this.model.bind("change",this.render,this)},tagName:"li",className:"timeglider-timeline-list-item",template:"${title}",events:{click:"toggleTimeline"},toggleTimeline:function(){o.toggleTimeline(this.model.get("id"))},render:function(){var E=this.model.get("id");g(this.el).html(g.tmpl(this.template,this.model.attributes)).data("timeline_id",E);return this}});g(h._views.TIMELINE_MENU_UL).html("");
_.each(o.timelineCollection.models,function(E){g(h._views.TIMELINE_MENU_UL).append((new p({model:E})).render().el)});k.position({my:"right bottom",at:"right top",of:g(h._views.TIMELINE_LIST_BT),offset:"-8, -12"}).hide();g(e).delegate(".timeglider-timeline-menu .close-button","click",function(){k.fadeOut()}).delegate(this._views.TIMELINE_LIST_BT,"click",function(){k.fadeIn()})},getTimezonePulldown:function(h,k){var p="<select name='timezone' id='"+h+"'>",E=false,a="selected";g.map(G.timezones,function(c){if(k==
c.offset&&E==false){a="selected";E=true}else a="";p+="<option value='"+c.offset+"' "+a+">"+c.name+"</option>"});p+="</select>";return p},buildSettingsMenu:function(){var h=g.tmpl(this._templates.settings_modal,{}).appendTo(this._views.CONTAINER),k=this.getTimezonePulldown("timeglider-settings-timezone",o.timeOffset.string);h.find(".timeglider-settings-timezone").append('<p>Make changes below, then click on "save". More settings options to come!</p>').append('<span class="settings-label">timezone:</span> '+
k).append("<p style='clear:both'>&nbsp;</p><div class='btn success' id='timeglider-settings-save'>save</div>");h.position({my:"right bottom",at:"right top",of:g(this._views.SETTINGS_BT),offset:"-8, -12"}).hide();g(e).delegate(".timeglider-settings-modal .close-button","click",function(){h.fadeOut()}).delegate(this._views.SETTINGS_BT,"click",function(){h.fadeIn()}).delegate("#timeglider-settings-save","click",function(){var p=g(e+" #timeglider-settings-timezone").val();o.setTimeoffset(p)})},buildSlider:function(){var h=
o.getZoomLevel();if(H.min_zoom==H.max_zoom)g(this._views.SLIDER_CONTAINER).css("display","none");else{H.display_zoom_level==true&&g("<div>").appendTo(this._views.SLIDER_CONTAINER).addClass("timeglider-zoomlevel-display").html("&nbsp;");var k=this;h=k.invSliderVal(h);var p=o.max_zoom,E=o.min_zoom;g(this._views.SLIDER).css("height",(1+p-E)*3).slider({steps:100,handle:g(".knob"),animate:300,orientation:"vertical",min:k.invSliderVal(p),max:k.invSliderVal(E),value:h,start:function(){k.sliderActive=true},
stop:function(){k.sliderActive=false},change:function(){},slide:function(a,c){o.setZoomLevel(k.invSliderVal(c.value))}})}},getEventDateLine:function(h){var k="<span class='timeglider-dateline-startdate'>"+h.startdateObj.format("",true,o.timeOffset)+"</span>";endDateF="";if(h.span==true)endDateF=" &ndash; <span class='timeglider-dateline-enddate'>"+h.enddateObj.format("",true,o.timeOffset)+"</span>";return k+endDateF},eventHover:function(h,k){var p=g(".timeglider-event-hover-info");k.date_display!=
"no"&&p.position({my:"left bottom",at:"left top",of:h,offset:"1, -10",collision:"flip flip"}).html(this.getEventDateLine(k));h.addClass("tg-event-hovered")},eventUnHover:function(h){g(".timeglider-event-hover-info").css("left","-1000px");h.removeClass("tg-event-hovered")},clearTicks:function(){this.tickNum=this.leftside=0;g(q).css("left",0);g(e+" .tg-timeline-envelope").remove();g(e+" .timeglider-tick").remove()},castTicks:function(){this.clearTicks();o.getZoomLevel();var h=o.getFocusDate(),k=o.getZoomInfo().width;
k=Math.ceil(this.dimensions.container.width/k)+4;var p="l";o.setTicksReady(false);this.addTick({type:"init",focus_date:h});for(h=1;h<=k;h+=1){this.addTick({type:p});p=p=="l"?"r":"l"}o.setTicksReady(true);this.displayFocusDate()},addTick:function(h){var k=0,p=0,E=p=0,a=0,c=0,m=c="",f={};c={};E={};var l={};c={};f="";l=o.getZoomInfo().unit;var j=o.getZoomInfo().width;a=o.getFocusDate();E=parseInt(this.dimensions.tick.top);a=o.addToTicksArray({type:h.type,unit:l},a);if(l=="mo"){c=G.getMonthAdj(a,j);j=
c.width;k=c.days}this.tickNum++;if(h.type=="init"){c=this.tickOffsetFromDate(o.getZoomInfo(),o.getFocusDate(),j);this.leftside=p=Math.ceil(this.dimensions.container.centerx+c);this.rightside=p+j}else if(h.type=="l")this.leftside=p=Math.floor(this.leftside-j);else if(h.type=="r"){p=Math.floor(this.rightside);this.rightside+=j}o.getTickBySerial(a).width=j;o.getTickBySerial(a).left=p;c=this._views.PLACE+"_"+l+"_"+a+"-"+this.tickNum;c=g("<div class='timeglider-tick' id='"+c+"'><div class='timeglider-tick-label' id='label'></div></div>").appendTo(q);
c.css({width:j,left:p,top:E});E=this.getTickMarksInfo({unit:l,width:j});E=k||E.tperu;p=j/E;if(p>5)for(h=k=0;h<E;h++){m="&nbsp;";if(p>16)if(l=="da"&&p>16)m=this.getHourLabelFromHour(h,p);else if(l=="mo")m=h+1;f+="<div class='timeglider-tick-sub-label' style='left:"+k+"px;width:"+p+"px'>"+m+"</div>";k+=p}f&&c.append("<div style='background-color:none;height:24px;width:"+(j+10)+"px;position:absolute;top:15px;left:0;overflow:hidden'>"+f+"</div>");l={unit:l,width:j,serial:a};f=this.getDateLabelForTick(l);
c.children("#label").text(f);return l},setCenterline:function(){o.options.show_centerline===true?g(this._views.CENTERLINE).css({height:this.dimensions.container.height,left:this.dimensions.container.centerx}):g(this._views.CENTERLINE).css({display:"none"})},getHourLabelFromHour:function(h,k){var p="";p=p="";p=h>12?h-12:h;if(p==0)p=12;return p+(k>60?":00":"")+(h>11?" pm":" am")},getTickMarksInfo:function(h){switch(h.unit){case "da":h=24;break;case "mo":h=30;break;case "ye":h=12;break;default:h=10}return{tperu:h}},
getDateLabelForTick:function(h){var k=h.serial,p=h.width;switch(h.unit){case "bill":return k==0?"1":k>0?k+" billion":k+" b.y. bce";case "hundredmill":return k==0?"1":k>0?k+"00 million":k+"00 m.y. bce";case "tenmill":return k==0?"1":k>0?k+"0 million":k+"0 m.y. bce";case "mill":return k==0?"1":k>0?k+" million":k+" m.y. bce";case "hundredthou":return k==0?"1":k>0?k+"00,000":k+"00,000 bce";case "tenthou":return k==0?"1":k>0?k+"0,000":k+"0,000 bce";case "thou":return k==0?"1("+k+")":k>0?k+"000":k+"000 bce";
case "ce":return k==0?"1("+k+")":k>0?k+"00":k+"00 bce";case "de":return k>120?k*10+"s":k*10;case "ye":return k;case "mo":h=G.getDateFromMonthNum(k);return p<120?G.monthNamesAbbr[h.mo]+" "+h.ye:G.monthNames[h.mo]+", "+h.ye;case "da":h=new G(G.getDateFromRD(k));return p<120?G.monthNamesAbbr[h.mo]+" "+h.da+", "+h.ye:G.monthNames[h.mo]+" "+h.da+", "+h.ye;default:return h.unit+":"+k+":"+p}},tickHangies:function(){var h=g(q).position().left,k=this.rightside+h-this.dimensions.container.width;if(this.leftside+
h>-100){h=this.addTick({type:"l"});this.appendTimelines(h)}else if(k<100){h=this.addTick({type:"r"});this.appendTimelines(h)}},tickOffsetFromDate:function(h,k,p){switch(h.unit){case "da":k=k.ho/24+k.mi/1440;p*=k;break;case "mo":h=G.getMonthDays(k.mo,k.ye);k=(k.da-1)/h+k.ho/(24*h)+k.mi/(1440*h);p*=k;break;case "ye":k=((k.mo-1)*30+k.da)/365;p*=k;break;case "de":k=k.ye%10/10+k.mo/120;p*=k;break;case "ce":k=k.ye%100/100+k.mo/1200;p*=k;break;case "thou":k=k.ye%1E3/1E3;p*=k;break;case "tenthou":k=k.ye%
1E4/1E4;p*=k;break;case "hundredthou":k=k.ye%1E5/1E5;p*=k;break;default:p=0}return-1*p},resetTicksHandle:function(){g(this._views.HANDLE).offset({left:g(e).offset().left})},easeOutTicks:function(){Math.abs(B)>5&&g(q).animate({left:"+="+3*B},1E3,"easeOutQuad",function(){debug.trace("stopping easing","note")})},getTimelineEventsByTick:function(h){var k=h.tick.unit,p=h.tick.serial;h=o.eventCollection.getTimelineHash(h.timeline.timeline_id);return h[k][p]&&h[k][p].length>0?h[k][p]:0},passesFilters:function(h,
k){var p=true,E="",a=[],c;E="";a=[];if(k<h.low_threshold||k>h.high_threshold)return false;if(E=o.filters.include){a=E.split(",");p=false;for(c=0;c<a.length;c++){E=RegExp(g.trim(a[c]),"i");if(h.title.match(E))p=true}}if(E=o.filters.exclude){a=E.split(",");for(c=0;c<a.length;c++){E=RegExp(g.trim(a[c]),"i");if(h.title.match(E))p=false}}E=h.icon;if(o.filters.legend.length>0)if(g.inArray(E,o.filters.legend)==-1)p=false;return p},freshTimelines:function(){var h=this,k,p,E,a=o.activeTimelines,c=o.ticksArray,
m="",f;p="";var l=h.dimensions.container.centerx;k=h.dimensions.container.width;var j=o.getFocusDate().sec,u=o.getZoomInfo().spp;o.getZoomInfo();p=[];var v=[],F=j-Math.floor(u*(k/2));E=f=0;for(var d,i=0,n=h.dimensions.container.height,y=i=0;y<a.length;y++){v=[];p=o.timelineCollection.get(a[y]);k=p.attributes;d=k.display;i=k.top?parseInt(k.top.replace("px","")):n-h.initTimelineVOffset;p=new r.TG_TimelineView({model:p});f=o.timeOffset.seconds/u;$tl=g(p.render().el).appendTo(q);$tl.draggable({axis:"y",
handle:".titleBar",stop:function(){var D=g(this).css("top"),J=g(this).attr("id");o.timelineCollection.get(J).set({top:D});o.refresh()}}).css({top:i,left:f});f=$tl.find(".titleBar");if(typeof k.bounds!="undefined"){p=l+(k.bounds.first-j)/u;E=l+(k.bounds.last-j)/u}else{p=l;E=l+300}E-=p;f.css({top:void 0,left:p,width:E}).data({lef:p,wid:E});if(d=="expanded")k.borg=m=new timeglider.TG_Org;for(f=0;f<c.length;f++){p=this.getTimelineEventsByTick({tick:c[f],timeline:k});g.merge(v,p)}_.each(k.spans,function(D){D.start<
F&&D.end>F&&g.inArray(D.id,v)==-1&&v.unshift(D.id)});p=this.compileTickEventsAsHtml(k,v,0,"sweep");i=H.event_overflow=="scroll"?0:k.hasImagesAbove?i-h.imageLaneHeight:i;if(d=="expanded"){p=m.getHTML("sweep",i);k.borg=m.getBorg()}p!="undefined"&&$tl.append(p.html);setTimeout(function(){h.registerEventImages($tl)},3)}h.registerTitles();g.publish("viewer.rendered")},appendTimelines:function(h){for(var k=o.activeTimelines,p,E="",a=0;a<k.length;a++){p=o.timelineCollection.get(k[a]).attributes;idArr=this.getTimelineEventsByTick({tick:h,
timeline:p});E=this.compileTickEventsAsHtml(p,idArr,h.serial,"append");if(p.display=="expanded")E=p.borg.getHTML(h.serial,p.top);p=g(e+" .tg-timeline-envelope#"+p.id).append(E.html);this.registerEventImages(p)}g.publish("viewer.rendered")},compileTickEventsAsHtml:function(h,k,p,E){var a=0,c=this.dimensions.container.centerx,m=h.display,f=$tl.height();stuff="";foSec=o.startSec;spp=o.getZoomInfo().spp;zl=o.getZoomInfo().level;buffer=20;img_ht=0;borg=h.borg;block_arg="sweep";if(E=="append")block_arg=
p;for(p=0;p<k.length;p++){ev=o.eventCollection.get(k[p]).attributes;if(this.passesFilters(ev,zl)===true){a=c+(ev.startdateObj.sec-foSec)/spp;if(m=="expanded"){impq=h.size_importance!==false?this.scaleToImportance(ev.importance,zl):1;ev.width=ev.titleWidth*impq+buffer;ev.fontsize=this.basicFontSize*impq;ev.left=a;ev.spanwidth=0;if(ev.span==true){ev.spanwidth=(ev.enddateObj.sec-ev.startdateObj.sec)/spp;if(ev.spanwidth>ev.width)ev.width=ev.spanwidth}img_ht=0;a=Math.ceil(ev.fontsize);if(ev.image&&ev.image.display_class===
"inline"){img_ht=(ev.image.scale||100)/100*ev.image.height+2;ev.width=ev.image.width>ev.width?ev.image.width:ev.width;ev.shape={ev_ht:a,img_ht:img_ht+32}}ev.height=a+img_ht;ev.top=f-ev.height;borg.addBlock(ev,block_arg)}else if(m=="collapsed")stuff+="<div id='"+ev.id+"' class='timeglider-event-collapsed' style='top:"+(f-2)+"px;left:"+a+"px'></div>"}}return m=="collapsed"?stuff:""},registerEventImages:function(h){g(e+" .timeglider-event-image-bar").each(function(){g(this).position({my:"top",at:"bottom",
of:h,offset:"0, 0"}).css("left",0)});g(e+" .timeglider-event-image-above").each(function(){g(this).css("display","block").position({my:"top",at:"top",of:g(e),offset:"0, 12"}).css({left:0})})},expandCollapseTimeline:function(h){h=o.timelineCollection.get(h).attributes;h.display=h.display=="expanded"?"collapsed":"expanded";o.refresh()},openTimelineModal:function(h){h=new this.timelineModal({model:o.timelineCollection.get(h)});g(h.render().el).appendTo("body").position({my:"left top",at:"left top",of:this._views.CONTAINER,
offset:"32, 32",collision:"fit fit"}).css("z-index",this.ztop++).draggable({stack:".timeglider-modal"})},createEventLinksMenu:function(h){if(!h)return"";var k="",p=0,E="",a="";if(typeof h=="string")k="<li><a href='"+h+"' target='_blank'>link</a></li>";else if(typeof h=="object")for(p=0;p<h.length;p++){E=h[p].url;a=h[p].label;k+="<li><a href='"+E+"' target='_blank'>"+a+"</a></li>"}return k},eventModal:function(h){g(e+" #"+h+"_modal").remove();var k=this,p=false,E=false,a="";a={};a=0;var c=H.event_modal.type;
a=g("#"+h);var m=o.eventCollection.get(h).attributes,f=m.image&&m.image.src?"<img src='"+m.image.src+"'>":"",l=this.createEventLinksMenu(m.link);h={title:m.title,description:m.description,id:h,dateline:k.getEventDateLine(m),links:l,image:f,video:m.video};if(m.video){h.video=m.video;c="full";E=true}else if(m.map)if(m.map.latlong){p=true;c="full"}switch(c){case "full":h=g.tmpl(k._templates.event_modal_full,h);h.appendTo(e).css({"z-index":k.ztop++}).position({my:"left top",at:"left top",of:e,offset:"0, 0",
collision:"none none"});if(p==true){h.find("#insert").append("<div id='map_modal_map'></div>");a=m.map.zoom||12;llarr=String(m.map.latlong).split(",");map_ll=new google.maps.LatLng(parseFloat(llarr[0]),parseFloat(llarr[1]));a={zoom:a,center:map_ll,mapTypeId:google.maps.MapTypeId.ROADMAP};a=new google.maps.Map(g("#map_modal_map")[0],a);if(m.map.markers)for(p=0;p<m.map.markers.length;p++){E=m.map.markers[p];new google.maps.MarkerImage(E.image,new google.maps.Size(24,32),new google.maps.Point(0,0),new google.maps.Point(0,
32));h=E.latlong.split(",");h=new google.maps.LatLng(h[0],h[1]);E=new google.maps.Marker({position:h,map:a,icon:E.icon,title:E.title,zIndex:E.zIndex})}}else E==true&&h.find("#insert").append("<iframe width='100%' height='300' src='"+m.video+"'></iframe></div>");m=k.dimensions.container.height;p=k.dimensions.container.width;E=g(e+" .full_modal_panel");h=E.width();a=E.height();E.css({top:(m-a)/2+"px",left:(p-h)/2+"px"});break;case "video":h=g.tmpl(k._templates.event_modal_video,h);h.appendTo(q).css("z-index",
k.ztop++).position({my:"right center",at:"left center",of:a,offset:"-12, -1",collision:"flip fit"}).hover(function(){g(this).css("z-index",k.ztop++)});break;default:h=g.tmpl(k._templates.event_modal_small,h);h.appendTo(q).css("z-index",k.ztop++).position({my:"center top",at:"center top",of:e,offset:"0, 100",collision:"fit fit"}).draggable().hover(function(){g(this).css("z-index",k.ztop++)})}},legendModal:function(h){var k=o.timelineCollection.get(h).attributes.legend,p=0,E="",a="",c="";p="";for(p=
0;p<k.length;p++){E=H.icon_folder+k[p].icon;a=k[p].title;c+="<li><img class='legend-icon' src='"+E+"'><span class='legend-info'>"+a+"</span></li>"}h={id:h,legend_list:c};g(e+" .timeglider-legend").remove();g.tmpl(this._templates.legend_modal,h).appendTo(e).css("z-index",this.ztop++).toggleClass("timeglider-display-none").position({my:"left top",at:"left top",of:e,offset:"16, -4",collision:"none none"});p=timeglider.mode==="authoring"?e+" .legend-info":e+" .legend-info, "+e+" .legend-icon";g(p).bind("mouseup",
function(m){m=g(m.target).parent().children("img").attr("src");g(this).parent().toggleClass("tg-legend-icon-selected");o.setFilters({origin:"legend",icon:m})})},parseHTMLTable:function(h){var k={},p=+new Date,E=[];g("#"+h).find("tr").each(function(a){var c=g(this).children(),m;if(a===0)E=c.map(function(){return g(this).attr("class").replace(/^.*?\btg-(\S+)\b.*?$/,"$1")}).get();else{m={};c.each(function(f){m[E[f]]=g(this).text()});k["prefix"+p++]=m}});return k}};r.TG_TimelineView=Backbone.View.extend({initialize:function(){var h=
this;this.model.bind("change:title",function(){g(h.el).find(".timeline-title-span").text(h.model.get("title"))});this.model.bind("destroy",this.remove,this)},tagName:"div",events:{"click .timeline-title-span":"titleClick"},className:"tg-timeline-envelope",getTemplate:function(){var h="<div class='titleBar'><div class='timeline-title'><span class='timeline-title-span'>${title}</span><div class='tg-timeline-env-buttons'>";if(this.model.get("description"))h+="<span class='timeline-info' data-timeline_id='${id}'>info</span>";
if(this.model.get("hasLegend"))h+="<span class='tg-timeline-legend-bt' data-timeline_id='${id}'>legend</span>";h+="<span class='expand-collapse' data-timeline_id='${id}'>exp/col</span>";h+="</div></div></div>";return h},render:function(){this.model.get("id");this.model.get("title");var h=this.getTemplate();g(this.el).html(g.tmpl(h,this.model.attributes)).attr("id",this.model.get("id"));return this},setText:function(){},titleClick:function(){o.timelineTitleClick(this.model.get("id"))},remove:function(){g(this.el).remove()}});
r.zoomTree=[{},{unit:"da",width:35E3,level:1,label:"5 hours"},{unit:"da",width:17600,level:2,label:"7 hours"},{unit:"da",width:8800,level:3,label:"10 hours"},{unit:"da",width:4400,level:4,label:"12 hours"},{unit:"da",width:2200,level:5,label:"14 hours"},{unit:"da",width:1100,level:6,label:"17 hours"},{unit:"da",width:550,level:7,label:"22 hours"},{unit:"da",width:432,level:8,label:"1 DAY"},{unit:"da",width:343,level:9,label:"1.5 days"},{unit:"da",width:272,level:10,label:"2 days"},{unit:"da",width:216,
level:11,label:"2.5 days"},{unit:"da",width:171,level:12,label:"3 days"},{unit:"da",width:136,level:13,label:"3.5 days"},{unit:"da",width:108,level:14,label:"4 days"},{unit:"mo",width:2509,level:15,label:"6 days"},{unit:"mo",width:1945,level:16,label:"1 WEEK"},{unit:"mo",width:1508,level:17,label:"10 days"},{unit:"mo",width:1169,level:18,label:"2 weeks"},{unit:"mo",width:913,level:19,label:"2.5 weeks"},{unit:"mo",width:719,level:20,label:"3 weeks"},{unit:"mo",width:566,level:21,label:"3.5 weeks"},
{unit:"mo",width:453,level:22,label:"1 MONTH"},{unit:"mo",width:362,level:23,label:"5.5 weeks"},{unit:"mo",width:290,level:24,label:"7 weeks"},{unit:"mo",width:232,level:25,label:"2 months"},{unit:"mo",width:186,level:26,label:"2.5 months"},{unit:"mo",width:148,level:27,label:"3 months"},{unit:"mo",width:119,level:28,label:"4 months"},{unit:"mo",width:95,level:29,label:"5 months"},{unit:"mo",width:76,level:30,label:"6 months"},{unit:"ye",width:723,level:31,label:"9 months"},{unit:"ye",width:573,level:32,
label:"1 YEAR"},{unit:"ye",width:455,level:33,label:"1.25 years"},{unit:"ye",width:361,level:34,label:"1.5 years"},{unit:"ye",width:286,level:35,label:"2 years"},{unit:"ye",width:227,level:36,label:"2.5 years"},{unit:"ye",width:179,level:37,label:"3 years"},{unit:"ye",width:142,level:38,label:"4 years"},{unit:"ye",width:113,level:39,label:"5 years"},{unit:"ye",width:89,level:40,label:"6 years"},{unit:"de",width:705,level:41,label:"8 years"},{unit:"de",width:559,level:42,label:"10 years"},{unit:"de",
width:443,level:43,label:"13 years"},{unit:"de",width:302,level:44,label:"16 years"},{unit:"de",width:240,level:45,label:"20 years"},{unit:"de",width:190,level:46,label:"25 years"},{unit:"de",width:150,level:47,label:"30 years"},{unit:"de",width:120,level:48,label:"40 years"},{unit:"de",width:95,level:49,label:"50 years"},{unit:"de",width:76,level:50,label:"65 years"},{unit:"ce",width:600,level:51,label:"80 years"},{unit:"ce",width:480,level:52,label:"100 years"},{unit:"ce",width:381,level:53,label:"130 years"},
{unit:"ce",width:302,level:54,label:"160 years"},{unit:"ce",width:240,level:55,label:"200 years"},{unit:"ce",width:190,level:56,label:"250 years"},{unit:"ce",width:150,level:57,label:"300 years"},{unit:"ce",width:120,level:58,label:"400 years"},{unit:"ce",width:95,level:59,label:"500 years"},{unit:"ce",width:76,level:60,label:"600 years"},{unit:"thou",width:603,level:61,label:"1000 years"},{unit:"thou",width:478,level:62,label:"1200 years"},{unit:"thou",width:379,level:63,label:"1800 years"},{unit:"thou",
width:301,level:64,label:"160 years"},{unit:"thou",width:239,level:65,label:"xxx years"},{unit:"thou",width:190,level:66,label:"xxx years"},{unit:"thou",width:150,level:67,label:"xxx years"},{unit:"thou",width:120,level:68,label:"xxx years"},{unit:"thou",width:95,level:69,label:"8,000 years"},{unit:"thou",width:76,level:70,label:"10,000 years"},{unit:"tenthou",width:603,level:71,label:"15,000 years"},{unit:"tenthou",width:358,level:72,label:"20,000 years"},{unit:"tenthou",width:213,level:73,label:"30,000 years"},
{unit:"tenthou",width:126,level:74,label:"60,000 years"},{unit:"tenthou",width:76,level:75,label:"100,000 years"},{unit:"hundredthou",width:603,level:76,label:"180,000 years"},{unit:"hundredthou",width:358,level:77,label:"300,000 years"},{unit:"hundredthou",width:213,level:78,label:"500,000 years"},{unit:"hundredthou",width:126,level:79,label:"800,000 years"},{unit:"hundredthou",width:76,level:80,label:"1 million years"},{unit:"mill",width:603,level:81,label:"1.2 million years"},{unit:"mill",width:358,
level:82,label:"2 million years"},{unit:"mill",width:213,level:83,label:"3 million years"},{unit:"mill",width:126,level:84,label:"5 million years"},{unit:"mill",width:76,level:85,label:"10 million years"},{unit:"tenmill",width:603,level:86,label:"15 million years"},{unit:"tenmill",width:358,level:87,label:"30 million years"},{unit:"tenmill",width:213,level:88,label:"50 million years"},{unit:"tenmill",width:126,level:89,label:"80 million years"},{unit:"tenmill",width:76,level:90,label:"100 million years"},
{unit:"hundredmill",width:603,level:91,label:"120 million years"},{unit:"hundredmill",width:358,level:92,label:"200 million years"},{unit:"hundredmill",width:213,level:93,label:"300 million years"},{unit:"hundredmill",width:126,level:94,label:"500 million years"},{unit:"hundredmill",width:76,level:95,label:"1 billion years"},{unit:"bill",width:603,level:96,label:"15 million years"},{unit:"bill",width:358,level:97,label:"30 million years"},{unit:"bill",width:213,level:98,label:"50 million years"},
{unit:"bill",width:126,level:99,label:"80 million years"},{unit:"bill",width:76,level:100,label:"100 billion years"}];r.calculateSecPerPx=function(h){for(var k=1;k<h.length;k++){var p=h[k],E=0;switch(p.unit){case "da":E=86400;break;case "mo":E=2419200;break;case "ye":E=31536E3;break;case "de":E=31536E4;break;case "ce":E=31536E5;break;case "thou":E=31536E6;break;case "tenthou":E=31536E7;break;case "hundredthou":E=31536E8;break;case "mill":E=31536E9;break;case "tenmill":E=31536E10;break;case "hundredmill":E=
31536E11;break;case "bill":E=31536E12}p.spp=E/parseInt(p.width)}}(r.zoomTree);r.getStringWidth=function(h){if(h)return g("#timeglider-measure-span").html(h).width()};String.prototype.removeWhitespace=function(){return this.replace(RegExp("\\n","g"),"")};if(debug)debug.trace=function(h,k){g("#"+k).text(h)};r.googleMapsInit=function(){};r.googleMapsLoaded=false;r.googleMapsLoad=function(){if(r.googleMapsLoaded==false){var h=document.createElement("script");h.type="text/javascript";h.src="http://maps.googleapis.com/maps/api/js?sensor=false&callback=timeglider.googleMapsInit";
document.body.appendChild(h);r.googleMapsLoaded=true}}})(timeglider);(function(r){var G={},A=r.TG_Date,o={},H=jQuery,B={};r.TG_Mediator=function(x,w){this.options=o=x;B=w;this._focusDate={};this._zoomInfo={};this._zoomLevel=1;this.ticksReady=false;this.ticksArray=[];this.startSec=0;this.activeTimelines=[];this.max_zoom=o.max_zoom;this.min_zoom=o.min_zoom;this.icon_folder=r.icon_folder=o.icon_folder||"js/timeglider/icons/";this.timeOffset=A.getTimeOffset(o.timezone);this.fixed_zoom=this.max_zoom==this.min_zoom?true:false;this.gesturing=false;this.gestureStartScale=
this.gestureStartZoom=0;this.filters={include:"",exclude:"",legend:[]};this.timelineCollection=new r.TG_TimelineCollection;this.eventCollection=new r.TG_EventCollection;this.imagesToSize=this.imagesSized=0;this.timelineDataLoaded=false;this.initial_timeline_id=o.initial_timeline_id||"";this.sole_timeline_id="";this.dimensions={};this.focusedEvent="";if(o.max_zoom===o.min_zoom)this.fixed_zoom=o.min_zoom;if(o.main_map){this.main_map=o.main_map;timeglider.mapping.setMap(this.main_map,this)}G=this};r.TG_Mediator.prototype=
{focusToEvent:function(x){this.focusedEvent=x;this.setFocusDate(x.startdateObj);H.publish("mediator.focusToEvent")},gotoDateZoom:function(x,w){var g=false;this.setFocusDate(new A(x));if(w)g=this.setZoomLevel(w);if(!w||g==false)this.refresh()},zoom:function(x){this.setZoomLevel(this.getZoomLevel()+parseInt(x))},getScope:function(){var x=this.getZoomInfo(),w=this.getFocusDate(),g=this.getActiveTimelinesBounds();return{spp:Math.round(x.spp),width:this.dimensions.container.width,focusDateSec:Math.round(w.sec),
timelines:this.activeTimelines,timelineBounds:g,container:B}},getActiveTimelinesBounds:function(){for(var x=this.activeTimelines,w={},g=99999999999,I=0,C=0;C<x.length;C++){w=this.timelineCollection.get(x[C]);g=w.get("bounds").first<g?w.get("bounds").first:g;I=w.get("bounds").last>I?w.get("bounds").last:I}return{first:g,last:I}},loadTimelineData:function(x){var w=this;if(x)if(typeof x==="object")w.parseTimelineData(x);else if(x.substr(0,1)=="#"){x=[w.getTableTimelineData(x)];w.parseTimelineData(x)}else H.getJSON(x,
function(g){w.parseTimelineData(g)});else{this.timelineDataLoaded=true;this.setZoomLevel(Math.floor((this.max_zoom+this.min_zoom)/2));this.tryLoading()}},mapMarkerClick:function(x){this.focusToEvent(x)},getTimelineCollection:function(){return this.timelineCollection},timelineTitleClick:function(x){H.publish("mediator.timelineTitleClick",{timeline_id:x})},getTableTimelineData:function(x){var w={},g=0,I=[],C,e,q="",s=H(x);w.id=x.substr(1);w.title=s.attr("title")||"untitled";w.description=s.attr("description")||
"";w.focus_date=s.attr("focus_date")||A.getToday;w.initial_zoom=s.attr("initial_zoom")||20;w.events=[];s.find("tr").each(function(z){var h=H(this).children(),k;if(z===0)I=h.map(function(){return H(this).attr("class").replace(/^.*?\btg-(\S+)\b.*?$/,"$1")}).get();else{k={};h.each(function(p){C=I[p];e=H(this).text();k[C]=e});q="ev_"+g++;k.id=q;w.events.push(k)}});s.css("display","none");return w},parseTimelineData:function(x){var w=0,g=x.length,I={};I={};for(var C=0;C<g;C++){I=x[C];I.mediator=this;I=
(new r.TG_Timeline(I)).toJSON();if(I.id.length>0){w++;this.swallowTimeline(I)}}if(w===0)alert("ERROR loading data: Check JSON with jsonLint");else{this.timelineDataLoaded=true;this.tryLoading()}},tryLoading:function(){var x=this.timelineDataLoaded==true;if(this.imagesSized==this.imagesToSize&&x){this.setInitialTimelines();H.publish("mediator.timelineDataLoaded")}},swallowTimeline:function(x){this.sole_timeline_id=x.id;this.timelineCollection.add(x);H.publish("mediator.timelineListChangeSignal")},
setInitialTimelines:function(){var x=this.initial_timeline_id||this.sole_timeline_id;if(timeglider.mode=="authoring")this.setZoomLevel(40);else x?setTimeout(function(){G.toggleTimeline(x)},500):this.setZoomLevel(40)},refresh:function(){this.startSec=this._focusDate.sec;H.publish("mediator.refreshSignal")},setTicksReady:function(x){this.ticksReady=x;x===true&&H.publish("mediator.ticksReadySignal")},setTimeoffset:function(x){this.timeOffset=A.getTimeOffset(x);this.refresh()},getTimeoffset:function(){return this.timeOffset},
setDimensions:function(x){this.dimensions=x;debug.log("dimensions:",x)},setFocusDate:function(x){if(x!=this._focusDate)this._focusDate=x},getFocusDate:function(){return this._focusDate},getZoomLevel:function(){return parseInt(this._zoomLevel)},setZoomLevel:function(x){if(x<=this.max_zoom&&x>=this.min_zoom){this.startSec=this._focusDate.sec;if(x!=this._zoomLevel){this._zoomLevel=x;this._zoomInfo=r.zoomTree[x];H.publish("mediator.zoomLevelChange");H.publish("mediator.scopeChange");return true}else return false}else return false},
getZoomInfo:function(){return this._zoomInfo},registerUIEvent:function(x){switch(x.name){case "dblclick":x=x.event.pageX-x.dimensions.container.offset.left-x.dimensions.container.width/2;var w=this.getZoomInfo().spp,g=this.getFocusDate().sec;x=new A(Math.floor(g+x*w));H.publish("mediator.dblclick",{date:x})}},setFilters:function(x){switch(x.origin){case "clude":this.filters.include=x.include;this.filters.exclude=x.exclude;break;case "legend":var w=_.last(x.icon.split("/"));if(w=="all"){this.filters.legend=
[];H.publish("mediator.legendAll")}else if(H.inArray(w,this.filters.legend)==-1)this.filters.legend.push(w);else{x=[];x=H.grep(this.filters.legend,function(g){return g!=w});this.filters.legend=x}}H.publish("mediator.filtersChange");H.publish("mediator.scopeChange");this.refresh()},getTicksOffset:function(){return this._ticksOffset},setTicksOffset:function(x){this._ticksOffset=x;H.publish("mediator.ticksOffsetChange");H.publish("mediator.scopeChange")},getTickBySerial:function(x){for(var w=this.ticksArray,
g=w.length,I=0;I<g;I++){var C=w[I];if(C.serial==x)return C}return false},addToTicksArray:function(x,w){if(x.type=="init"){x.serial=A.getTimeUnitSerial(w,x.unit);this.ticksArray=[x]}else if(x.type=="l"){x.serial=this.ticksArray[0].serial-1;this.ticksArray.unshift(x)}else{x.serial=this.ticksArray[this.ticksArray.length-1].serial+1;this.ticksArray.push(x)}H.publish("mediator.ticksArrayChange");return x.serial},toggleTimeline:function(x){var w=this.timelineCollection.get(x).attributes,g=H.inArray(x,this.activeTimelines);
if(g==-1){this.activeTimelines.push(x);this.setFocusDate(new A(w.focus_date));this.setZoomLevel(w.initial_zoom)}else{this.activeTimelines.splice(g,1);this.refresh()}H.publish("mediator.activeTimelinesChange")},reportImageSize:function(x){var w=G.eventCollection.get(x.id);if(w.has("image")){if(x.error){w.attributes.image={};debug.log("WHOOPS: MISSING IMAGE: "+x.src)}else{w.attributes.image.width=x.width;w.attributes.image.height=x.height}this.imagesSized++;this.imagesSized==this.imagesToSize&&this.tryLoading()}}};
r.getLowHigh=function(x){x=_.sortBy(x,function(w){return parseInt(w)});return{low:_.first(x),high:_.last(x)}};r.validateOptions=function(x){this.optionsMaster={initial_focus:{type:"date"},timezone:{type:"timezone"},editor:{type:"string"},backgroundColor:{type:"color"},backgroundImage:{type:"color"},min_zoom:{type:"number",min:1,max:100},max_zoom:{type:"number",min:1,max:100},initial_zoom:{type:"number",min:1,max:100},show_centerline:{type:"boolean"},display_zoom_level:{type:"boolean"},data_source:{type:"url"},
basic_fontsize:{type:"number",min:9,max:100},mouse_wheel:{type:"string",possible:["zoom","pan"]},initial_timeline_id:{type:"string"},icon_folder:{type:"string"},show_footer:{type:"boolean"},display_zoom_level:{type:"boolean"},event_modal:{type:"object"},event_overflow:{type:"string"}};var w=this,g="";H.each(x,function(I,C){if(w.optionsMaster[I])switch(w.optionsMaster[I].type){case "string":if(typeof C!="string")g+=I+" needs to be a string.\n";if(w.optionsMaster[I].possible)if(H.inArray(C,w.optionsMaster[I].possible)==
-1)g+=I+" must be: "+w.optionsMaster[I].possible.join(" or ");break;case "number":if(typeof C!="number")g+=C+" needs to be a number.\n";if(w.optionsMaster[I].min)if(C<w.optionsMaster[I].min)g+=I+" must be greater than or equal to "+w.optionsMaster[I].min+"\n";if(w.optionsMaster[I].max)if(C>w.optionsMaster[I].max)g+=I+" must be less than or equal to "+w.optionsMaster[I].max+"\n";break;case "timezone":var e=/[+|-]?[0-9]+:[0-9]+/;if(H.inArray(C,["New York","Denver","Chicago","Los Angeles"])==-1&&C.match(e)==
-1)g+="The timezone is not formatted properly";break;case "boolean":if(typeof C!="boolean")g+=C+" needs to be a number.\n"}});return g}})(timeglider);(function(r){var G,A,o=timeglider,H=timeglider.TG_Date;r.widget("timeglider.timeline",{options:{timezone:"00:00",initial_focus:o.TG_Date.getToday(),editor:"none",min_zoom:1,max_zoom:100,show_centerline:true,data_source:"",culture:"en",basic_fontsize:12,mouse_wheel:"zoom",initial_timeline_id:"",icon_folder:"js/timeglider/icons/",show_footer:true,display_zoom_level:true,event_modal:{href:"",type:"default"},event_overflow:"plus"},_create:function(){this._id=r(this.element).attr("id");this.element.html("<div class='timeglider-container'><div class='timeglider-loading'>loading</div><div class='timeglider-centerline'></div><div class='timeglider-date-display'></div><div class='timeglider-truck' id='tg-truck'><div class='timeglider-ticks'><div class='timeglider-handle'></div></div></div><div class='timeglider-slider-container'><div class='timeglider-slider'></div><div class='timeglider-pan-buttons'><div class='timeglider-pan-left'></div><div class='timeglider-pan-right'></div></div></div><div class='timeglider-footer'><div class='timeglider-logo'></div><div class='timeglider-footer-button timeglider-filter-bt'></div><div class='timeglider-footer-button timeglider-settings-bt'></div><div class='timeglider-footer-button timeglider-list-bt'></div></div><div class='timeglider-event-hover-info'></div></div><span id='timeglider-measure-span'></span>")},
_init:function(){var B=timeglider.validateOptions(this.options);if(B==""){o.TG_Date.setCulture(this.options.culture);A=new o.TG_Mediator(this.options,this.element);G=new o.TG_PlayerView(this,A);A.setFocusDate(new H(this.options.initial_focus));A.loadTimelineData(this.options.data_source)}else alert("Rats. There's a problem with your widget settings:"+B)},goTo:function(B,x){A.gotoDateZoom(B,x)},resize:function(){G.resize()},getMediator:function(){return A},getScope:function(){return A.getScope()},
zoom:function(B){switch(B){case "in":B=-1;break;case "out":B=1}if(B>99||B<-99)return false;A.zoom(B)},load:function(B){A.loadTimelineData(B)},panButton:function(B,x){var w=0;switch(x){case "left":w=30;break;case "right":w=-30;break;default:w=x}G.setPanButton(B,w)},destroy:function(){r.Widget.prototype.destroy.apply(this,arguments);r(this.element).html("")}})})(jQuery);
